╔══════════════════════════════════════════════════════════════════════════╗
║                                                                          ║
║    CONFIGURAZIONE EMAIL NEXIO SOLUTION - QUICK REFERENCE                ║
║    CollaboraNexio - Aggiornamento del 06 Ottobre 2025                  ║
║                                                                          ║
╚══════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────┐
│ CREDENZIALI NEXIO SOLUTION                                               │
└──────────────────────────────────────────────────────────────────────────┘

  Server SMTP:    mail.nexiosolution.it
  Porta:          465 (SSL)
  Username:       info@nexiosolution.it
  Password:       Ricord@1991
  From Email:     info@nexiosolution.it
  From Name:      CollaboraNexio
  Reply-To:       info@nexiosolution.it

  ⚠️  NON committare password in Git!

┌──────────────────────────────────────────────────────────────────────────┐
│ FILE MODIFICATI                                                          │
└──────────────────────────────────────────────────────────────────────────┘

  ✅ includes/config_email.php (config principale - con password)
  ✅ includes/config_email.sample.php (template)
  ✅ includes/email_config.php (fallback database)

┌──────────────────────────────────────────────────────────────────────────┐
│ DATABASE UPDATE (OPZIONALE)                                              │
└──────────────────────────────────────────────────────────────────────────┘

  Script SQL già pronto:
  database/update_nexio_email_config.sql

  Esecuzione:
  mysql -u root collaboranexio < database/update_nexio_email_config.sql

  Oppure da phpMyAdmin:
  http://localhost:8888/phpmyadmin → SQL → Importa file

┌──────────────────────────────────────────────────────────────────────────┐
│ VERIFICA CONFIGURAZIONE                                                  │
└──────────────────────────────────────────────────────────────────────────┘

  Script di verifica automatica:
  http://localhost:8888/CollaboraNexio/verify_email_nexio_config.php

  Controlla:
  - ✅ File config corretti
  - ✅ Fallback configurato
  - ✅ loadEmailConfig() funziona
  - ✅ Database aggiornato (se presente)
  - ✅ PHPMailer installato

┌──────────────────────────────────────────────────────────────────────────┐
│ TEST EMAIL                                                               │
└──────────────────────────────────────────────────────────────────────────┘

  1. TEST WELCOME EMAIL:
     - Vai su: http://localhost:8888/CollaboraNexio/utenti.php
     - Crea nuovo utente con TUA email reale
     - Controlla inbox (anche spam)
     - Mittente atteso: CollaboraNexio <info@nexiosolution.it>

  2. TEST PASSWORD RESET:
     - Vai su: http://localhost:8888/CollaboraNexio/login.php
     - Click "Password dimenticata?"
     - Inserisci email utente esistente
     - Controlla inbox

  3. CONTROLLA LOG:
     tail -f logs/mailer_error.log

┌──────────────────────────────────────────────────────────────────────────┐
│ DEBUG (se email non funziona)                                            │
└──────────────────────────────────────────────────────────────────────────┘

  1. ABILITA DEBUG MODE:
     In includes/config_email.php:
     define('EMAIL_DEBUG_MODE', true);
     define('EMAIL_SMTP_VERIFY_SSL', false); // Solo se errori SSL locale

  2. TEST SMTP DIRETTO:
     http://localhost:8888/CollaboraNexio/test_mailer_smtp.php

  3. TEST CONFIG LOADING:
     http://localhost:8888/CollaboraNexio/test_email_config_loading.php

  4. CONTROLLA LOG:
     cat logs/mailer_error.log
     cat logs/php_errors.log

┌──────────────────────────────────────────────────────────────────────────┐
│ ERRORI COMUNI E SOLUZIONI                                                │
└──────────────────────────────────────────────────────────────────────────┘

  ❌ SMTP connect() failed
     → Verifica porta 465 aperta nel firewall
     → Verifica connessione internet

  ❌ Authentication failed
     → Controlla EMAIL_SMTP_PASSWORD = 'Ricord@1991'
     → Verifica username = info@nexiosolution.it

  ❌ SSL certificate problem
     → In sviluppo locale: EMAIL_SMTP_VERIFY_SSL = false
     → In produzione: sempre true

  ❌ Connection timed out
     → Server non raggiungibile
     → Verifica DNS: ping mail.nexiosolution.it

  ❌ Email non arriva
     → Controlla spam/promozioni
     → Verifica logs/mailer_error.log
     → Test SMTP con debug mode

┌──────────────────────────────────────────────────────────────────────────┐
│ MODULI CHE USANO EMAIL                                                   │
└──────────────────────────────────────────────────────────────────────────┘

  ✅ api/users/create.php (welcome email)
  ✅ api/users/create_v2.php (welcome email v2)
  ✅ api/users/create_v3.php (welcome email v3)
  ✅ api/auth/request_password_reset.php (reset password)
  ✅ includes/calendar.php (inviti eventi - se configurato)

  Tutti usano:
  - includes/mailer.php (helper centralizzato)
  - includes/EmailSender.php (wrapper legacy)

┌──────────────────────────────────────────────────────────────────────────┐
│ CHECKLIST FINALE                                                         │
└──────────────────────────────────────────────────────────────────────────┘

  File Config:
  [ ] config_email.php contiene mail.nexiosolution.it
  [ ] config_email.php contiene info@nexiosolution.it
  [ ] config_email.php contiene Ricord@1991
  [ ] config_email.php ha porta 465

  Database (opzionale):
  [ ] Script update_nexio_email_config.sql eseguito
  [ ] system_settings contiene smtp_host = mail.nexiosolution.it

  Test:
  [ ] Creazione utente invia email welcome
  [ ] Reset password invia email reset
  [ ] Email ricevute con mittente corretto
  [ ] Link nelle email funzionanti

  Sicurezza:
  [ ] config_email.php in .gitignore
  [ ] Password NON committata
  [ ] EMAIL_DEBUG_MODE = false in produzione

┌──────────────────────────────────────────────────────────────────────────┐
│ SUPPORTO                                                                 │
└──────────────────────────────────────────────────────────────────────────┘

  Report completo: NEXIO_EMAIL_UPDATE_REPORT.md
  Script verifica: verify_email_nexio_config.php

  Server email: Nexio Solution
  Dominio: nexiosolution.it
  Email supporto: info@nexiosolution.it

┌──────────────────────────────────────────────────────────────────────────┐
│ NOTE IMPORTANTI                                                          │
└──────────────────────────────────────────────────────────────────────────┘

  🔐 SICUREZZA:
     - Password in config_email.php (NON committare!)
     - File in .gitignore
     - Usare config_email.sample.php come template

  🔄 PRIORITÀ CARICAMENTO CONFIG:
     1. includes/config_email.php (se esiste) ← PRIORITÀ
     2. Database system_settings (se configurato)
     3. includes/email_config.php fallback

  🌍 PRODUZIONE vs SVILUPPO:
     Dev:  EMAIL_DEBUG_MODE = true, VERIFY_SSL = false
     Prod: EMAIL_DEBUG_MODE = false, VERIFY_SSL = true

  ✅ RETROCOMPATIBILITÀ:
     - Tutti i moduli esistenti funzionano senza modifiche
     - Solo credenziali aggiornate, logica invariata

╔══════════════════════════════════════════════════════════════════════════╗
║  Configurazione completata - Sistema pronto per l'uso                   ║
╚══════════════════════════════════════════════════════════════════════════╝
