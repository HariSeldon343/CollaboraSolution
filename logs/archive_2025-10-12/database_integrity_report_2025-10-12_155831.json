{
    "overall_status": "critical",
    "health_score": 84,
    "timestamp": "2025-10-12 15:58:30",
    "critical_issues": [
        {
            "issue": "OnlyOffice table 'document_editor_callbacks' does not exist",
            "severity": "critical",
            "fix_script": "Run OnlyOffice migration script"
        },
        {
            "issue": "Files table missing editor columns: last_modified_by",
            "severity": "critical",
            "fix_script": "ALTER TABLE files ADD COLUMN [column_definitions]"
        }
    ],
    "warnings": [
        {
            "warning": "2 tables lack custom indexes",
            "severity": "warning",
            "recommendation": "Review and add appropriate indexes for query performance"
        }
    ],
    "recommendations": [
        "Consider adding deleted_at to indexes on 'document_editor_config' for soft delete performance"
    ],
    "metrics": {
        "database_version": "10.4.32-MariaDB",
        "files": {
            "total_files": 21,
            "editable_files": "15",
            "active_files": "9"
        },
        "foreign_keys": {
            "total": 135,
            "by_table": {
                "activity_logs": 1,
                "approval_notifications": 4,
                "audit_logs": 3,
                "calendar_events": 3,
                "calendar_shares": 5,
                "chat_channels": 3,
                "chat_channel_members": 5,
                "chat_messages": 6,
                "chat_message_reads": 5,
                "document_approvals": 5,
                "document_editor": 4,
                "document_editor_changes": 5,
                "document_editor_config": 1,
                "document_editor_locks": 5,
                "document_editor_sessions": 4,
                "document_versions": 3,
                "editor_sessions": 2,
                "event_attendees": 2,
                "files": 5,
                "file_shares": 7,
                "file_versions": 5,
                "folders": 3,
                "italian_municipalities": 1,
                "password_expiry_notifications": 1,
                "projects": 4,
                "project_members": 6,
                "project_milestones": 2,
                "tasks": 9,
                "task_assignments": 7,
                "task_comments": 7,
                "tenants": 1,
                "tenant_locations": 3,
                "users": 1,
                "user_permissions": 4,
                "user_tenant_access": 3
            }
        }
    },
    "fix_scripts": [],
    "checks": [
        {
            "category": "onlyoffice",
            "name": "tables_exist",
            "status": "fail",
            "data": {
                "expected": 3,
                "found": 2,
                "tables": [
                    "document_editor_sessions",
                    "document_editor_config"
                ]
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "orphaned_sessions",
            "status": "pass",
            "data": {
                "count": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "valid_user_sessions",
            "status": "pass",
            "data": {
                "invalid_count": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "stale_sessions",
            "status": "warning",
            "data": {
                "total_open": 0,
                "very_stale": null,
                "extremely_stale": null
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "editor_configs",
            "status": "pass",
            "data": {
                "tenants_with_config": 8
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "files_table_columns",
            "status": "fail",
            "data": {
                "missing_columns": [
                    "last_modified_by"
                ]
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "onlyoffice",
            "name": "file_formats",
            "status": "pass",
            "data": {
                "format_distribution": [
                    {
                        "editor_format": null,
                        "count_by_format": 5
                    },
                    {
                        "editor_format": "cell",
                        "count_by_format": 1
                    },
                    {
                        "editor_format": "word",
                        "count_by_format": 3
                    }
                ]
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "core",
            "name": "orphaned_files",
            "status": "pass",
            "data": {
                "count": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "core",
            "name": "orphaned_users",
            "status": "pass",
            "data": {
                "count": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "core",
            "name": "folder_integrity",
            "status": "pass",
            "data": {
                "broken_refs": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "core",
            "name": "circular_folders",
            "status": "pass",
            "data": {
                "deep_folders": 0
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "foreign_keys",
            "name": "constraint_rules",
            "status": "pass",
            "data": {
                "total_constraints": 164,
                "cascade_delete": 131,
                "restrict_delete": 3
            },
            "timestamp": "15:58:30"
        },
        {
            "category": "indexes",
            "name": "tables_without_indexes",
            "status": "warning",
            "data": {
                "count": 2,
                "tables": [
                    "files_backup_20250927_134246",
                    "tenants_backup_locations_20251007"
                ]
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "consistency",
            "name": "invalid_file_sizes",
            "status": "pass",
            "data": {
                "count": 0
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "consistency",
            "name": "duplicate_session_tokens",
            "status": "pass",
            "data": {
                "count": 0
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "consistency",
            "name": "tenant_distribution",
            "status": "pass",
            "data": {
                "tenants": 1,
                "distribution": {
                    "1": {
                        "files": 9,
                        "users": 2
                    }
                }
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "automation",
            "name": "event_scheduler",
            "status": "pass",
            "data": {
                "status": "ON"
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "automation",
            "name": "scheduled_events",
            "status": "pass",
            "data": {
                "count": 1
            },
            "timestamp": "15:58:31"
        },
        {
            "category": "automation",
            "name": "stored_procedures",
            "status": "pass",
            "data": {
                "count": 8
            },
            "timestamp": "15:58:31"
        }
    ]
}