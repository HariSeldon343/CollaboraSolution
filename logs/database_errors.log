[2025-10-28 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'first_response_time' in 'field list' - SQL: 
        SELECT AVG(first_response_time) as avg_time
        FROM tickets
        WHERE tenant_id = ? AND deleted_at IS NULL
          AND first_response_time IS NOT NULL
    
[2025-10-28 06:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'first_response_time' in 'field list'
[2025-10-28 06:50:08] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous - SQL: 
            SELECT
                assigned_to,
                u.name as assignee_name,
                COUNT(*) as count
            FROM tickets t
            LEFT JOIN users u ON t.assigned_to = u.id AND u.deleted_at IS NULL
            WHERE tenant_id = ? AND deleted_at IS NULL
              AND t.status IN ('open', 'in_progress', 'waiting_response')
            GROUP BY assigned_to, u.name
            ORDER BY count DESC
        
[2025-10-28 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous
[2025-10-28 06:50:18] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-28 06:50:18] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-28 06:50:18] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 06:50:18] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 06:50:19] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 06:50:19] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 07:07:29] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 09:30:34] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 12:49:54] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 14:50:30] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 17:01:23] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-28 17:01:23] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-28 17:01:23] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 17:01:23] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 18:58:52] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`tenant_id`, `user_id`, `action`, `entity_type`, `entity_id`, `description`, `old_values`, `new_values`, `metadata`, `ip_address`, `user_agent`, `session_id`, `request_method`, `request_url`, `severity`, `status`, `created_at`) VALUES (:tenant_id, :user_id, :action, :entity_type, :entity_id, :description, :old_values, :new_values, :metadata, :ip_address, :user_agent, :session_id, :request_method, :request_url, :severity, :status, :created_at)
[2025-10-28 18:58:52] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs`
[2025-10-28 19:04:40] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`tenant_id`, `user_id`, `action`, `entity_type`, `entity_id`, `description`, `old_values`, `new_values`, `metadata`, `ip_address`, `user_agent`, `session_id`, `request_method`, `request_url`, `severity`, `status`, `created_at`) VALUES (:tenant_id, :user_id, :action, :entity_type, :entity_id, :description, :old_values, :new_values, :metadata, :ip_address, :user_agent, :session_id, :request_method, :request_url, :severity, :status, :created_at)
[2025-10-28 19:04:40] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs`
[2025-10-28 19:40:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'TABLE_SCHEMA' in 'where clause' - SQL: SELECT CONSTRAINT_NAME, CHECK_CLAUSE
        FROM information_schema.CHECK_CONSTRAINTS
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME = 'audit_logs'
        ORDER BY CONSTRAINT_NAME
[2025-10-29 06:53:59] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 06:53:59] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 06:53:59] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 06:53:59] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 13:39:15] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 13:39:15] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 13:39:16] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 13:39:16] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 13:39:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:23] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:24] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:26] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:31] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 14:29:53] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 14:29:53] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 14:29:53] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 14:29:53] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW INDEX FROM file_assignments
[2025-10-29 14:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: 
        SELECT CONSTRAINT_NAME
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
    
[2025-10-29 14:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SELECT COUNT(*) as total FROM `workflow_roles` WHERE `deleted_at` IS NULL
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW INDEX FROM file_assignments
[2025-10-29 14:54:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: 
        SELECT CONSTRAINT_NAME
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
    
[2025-10-29 14:54:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SELECT COUNT(*) as total FROM `workflow_roles` WHERE `deleted_at` IS NULL
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'DELETE_RULE' in 'field list' - SQL: 
        SELECT
            TABLE_NAME,
            COLUMN_NAME,
            CONSTRAINT_NAME,
            REFERENCED_TABLE_NAME,
            REFERENCED_COLUMN_NAME,
            DELETE_RULE,
            UPDATE_RULE
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
        ORDER BY TABLE_NAME, CONSTRAINT_NAME
    
[2025-10-29 15:50:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'DELETE_RULE' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:19:54] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 19:19:54] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 19:19:55] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 19:19:55] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 19:20:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:20:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:20:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:20:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:20:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:20:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:21:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:21:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:21:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:21:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:21:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:21:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:21:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:21:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:22:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:22:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:22:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:22:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:22:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:22:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:22:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:22:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:24:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:24:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:24:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:24:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:25:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:25:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:25:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:25:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:36:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:36:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:36:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:36:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:37:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:37:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:37:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:37:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:43:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:43:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:43:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:43:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:44:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:44:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:44:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:44:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:44:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:44:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:44:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:44:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:45:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:45:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:45:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:45:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:45:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:45:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:45:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:45:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:46:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:46:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:47:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:47:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:47:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:47:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:48:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:48:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:48:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:48:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:49:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:49:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:49:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:49:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 20:58:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:42] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 20:58:42] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 20:58:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 20:58:43] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 20:58:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:59:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:59:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:59:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:59:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:59:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:59:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:59:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:59:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:00:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:00:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:00:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:00:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:00:15] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 21:00:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 21:00:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:00:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:00:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:00:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:01:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:01:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:01:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:01:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:01:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:01:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:01:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:01:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:03:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:03:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:03:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:03:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:04:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:04:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:04:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:04:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 10:12:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 10:12:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 10:12:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 10:12:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 10:13:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:13:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:13:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:13:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:13:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:13:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:13:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:13:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:14:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:14:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:14:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:14:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:14:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:14:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:14:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:14:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:15:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:15:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:15:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:15:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:15:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:15:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:15:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:15:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:17:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:17:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:17:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:17:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:18:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:18:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:18:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:18:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 11:52:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:52:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:52:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:52:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:53:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:53:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:53:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:53:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:53:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:53:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:54:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:54:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:54:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:54:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:54:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:54:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:54:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:54:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:55:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:55:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:56:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:56:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:56:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:56:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:57:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:57:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:57:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:57:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:58:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:58:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:59:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:59:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:10:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:10:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:10:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:10:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:11:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:11:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:11:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:11:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:11:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:11:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:11:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:11:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:12:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:12:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:12:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:12:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:12:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:12:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:12:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:12:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:13:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:13:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:13:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:13:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:14:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:14:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:14:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:14:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:15:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:15:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:15:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:15:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:16:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:16:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:16:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:16:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:31:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:31:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:31:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:31:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:32:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:32:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:32:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:32:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:32:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:32:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:32:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:32:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:33:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:33:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:33:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:33:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:33:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:33:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:33:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:33:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:35:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:35:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:35:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:35:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:36:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:36:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:36:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:36:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:43:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:43:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:43:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:43:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:43:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:43:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:44:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:44:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:44:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:44:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:44:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:45:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:45:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:45:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:45:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:46:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:46:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:46:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:46:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:47:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:47:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:07:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:07:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:07:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:07:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:08:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:08:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:08:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:08:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:08:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:08:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:08:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:08:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:09:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:09:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:09:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:09:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:09:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:09:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:09:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:09:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:10:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:10:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:10:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:10:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:10:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:10:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:10:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:10:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:11:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:11:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:11:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:11:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:12:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:12:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:12:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:12:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:13:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:13:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:13:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:13:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:32:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 14:32:57] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 14:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:33:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:33:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:33:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:33:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:33:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:33:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:34:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:34:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:34:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:34:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:35:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:35:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:35:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:35:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:37:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:37:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:37:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:37:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:38:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:38:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:38:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:38:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:39:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:40:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:40:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:40:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:40:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:40:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:40:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:40:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:40:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:41:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:41:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:41:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:41:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:41:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:41:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:41:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:41:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:42:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:42:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:42:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:42:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:43:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:43:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:43:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:43:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:44:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:44:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:44:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:44:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:44:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:45:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:45:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:45:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:45:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:46:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:46:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:46:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:46:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:46:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:47:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:47:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:49:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:49:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:49:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:49:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:50:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:50:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:50:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:50:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:51:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:51:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:51:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:51:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:54:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 14:54:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 14:54:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:54:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:54:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:54:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:54:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:54:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:54:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:54:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:55:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:55:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:55:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:55:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:55:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:55:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:55:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:55:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:56:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:56:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:56:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:56:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:56:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:56:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:56:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:56:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:58:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:58:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:59:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:59:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 15:00:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 15:00:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 15:00:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 15:00:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-31 09:36:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-31 09:36:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-31 09:36:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:36:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:36:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:36:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:37:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:37:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:37:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:37:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:37:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:38:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:38:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:38:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:38:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:38:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:39:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:39:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:39:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:39:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:40:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:40:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:40:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:40:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:41:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:41:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:41:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:41:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:42:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:42:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:42:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:42:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:43:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:43:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:43:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:43:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:41:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 10:41:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:42:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:42:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:42:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:43:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:43:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:43:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:43:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:57] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:44:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:44:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:44:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:44:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:44:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:44:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:44:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:45:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:45:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:45:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:45:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:45:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:45:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:45:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:45:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:46:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:46:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:46:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:46:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:46:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:46:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:46:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:46:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:47:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:47:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:47:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:47:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:47:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:47:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:47:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:47:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:48:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:48:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:48:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:48:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:49:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:49:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:49:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:49:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:50:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:50:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:50:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:50:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:38:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:38:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:38:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:38:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:38:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:38:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:38:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:38:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:39:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:39:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:39:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:39:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:39:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:39:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:39:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:39:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:40:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:40:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:40:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:40:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:40:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:40:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:40:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:40:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:41:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:41:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:42:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:42:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:42:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:42:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:42:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:42:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:42:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:42:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:43:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:43:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:43:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:43:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:43:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:43:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:43:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:43:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:44:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:44:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:44:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:44:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:44:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:44:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:44:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:44:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:45:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:45:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:45:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:45:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:46:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:46:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:46:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:46:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:47:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:47:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:47:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:47:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 14:24:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 14:24:20] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 14:24:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:24:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:24:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:24:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:25:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:25:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:25:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:25:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:25:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:25:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:25:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:25:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:26:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:26:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:26:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:26:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:26:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:26:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:26:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:26:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:27:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:27:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:27:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:27:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:28:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:28:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:28:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:28:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:29:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:29:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:29:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:29:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:30:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:30:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:30:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:30:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:31:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:31:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:31:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:31:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:27:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:27:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:41] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-01 17:28:41] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-01 17:28:42] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:42] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:42] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:42] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:43] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:29:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:29:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:29:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:29:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:29:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:29:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:29:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:29:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:30:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:30:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:30:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:30:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:30:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:30:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:30:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:30:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:31:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:31:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:31:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:31:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:31:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:31:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:31:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:31:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:32:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:32:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:32:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:32:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:33:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:33:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:34:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:34:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:35:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:35:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:36:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:36:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:36:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:36:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 06:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT u.id, u.name, u.email, uta.role
         FROM users u
         JOIN user_tenant_access uta ON u.id = uta.user_id
         WHERE u.id = ?
           AND uta.tenant_id = ?
           AND u.deleted_at IS NULL
           AND uta.deleted_at IS NULL
[2025-11-02 06:19:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:19:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:19:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:19:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:19:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:19:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:19:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:20:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:20:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:20:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:20:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:20:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:20:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:20:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:20:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:21:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:21:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:21:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:21:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:21:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:21:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:22:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:22:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:23:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:23:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:24:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:24:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:25:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:25:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 06:35:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:35:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:35:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:35:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:35:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:35:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:35:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:35:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:36:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:36:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:36:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:36:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:36:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:36:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:36:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:36:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:37:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:37:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:37:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:37:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:37:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:37:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:37:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:37:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:38:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:38:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:38:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:38:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:39:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:39:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:39:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:39:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:40:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:40:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:40:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:40:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:41:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:41:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:41:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:41:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:12:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:12:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:12:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:12:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:13:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:13:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:13:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:13:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:13:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:13:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:13:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:13:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:14:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:14:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:14:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:14:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:15:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:15:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:15:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:15:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:15:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:15:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:15:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:15:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:15:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:15:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:16:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:16:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:17:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:17:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:17:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:17:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:18:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:18:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:18:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:18:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:19:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:19:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:19:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:19:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:20:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:20:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:41:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:41:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:43:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:43:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:43:50] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-02 08:43:50] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-02 08:43:51] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-02 08:43:51] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-02 08:43:51] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-02 08:43:51] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:43:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:44:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:44:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:44:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:44:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:44:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:44:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:45:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:45:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 10:16:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 10:16:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 10:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 10:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 10:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 10:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:17:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:17:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:17:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:17:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:17:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:17:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:18:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:18:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:18:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:18:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:19:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:19:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:19:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:19:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:19:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:20:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:20:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:21:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:21:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:22:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:22:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:20:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:20:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:20:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:20:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:20:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:21:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:21:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:21:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:21:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:21:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:21:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:21:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:21:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:22:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:22:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:22:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:22:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:22:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:22:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:22:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:22:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:23:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:23:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:23:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:23:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:23:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:23:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:23:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:23:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:24:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:24:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:25:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:25:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:26:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:26:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:26:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:26:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:48:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:48:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:48:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:48:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:48:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:49:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:49:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:49:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:49:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:49:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:49:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:49:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:49:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:50:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:50:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:50:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:50:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:51:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:51:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:51:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:51:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:52:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:52:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:52:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:52:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:53:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:53:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:53:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:53:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:54:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:54:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:54:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:54:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 05:53:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-03 05:53:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 05:53:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:53:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:53:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:53:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:54:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:54:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:54:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:54:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:54:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:54:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:54:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:54:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:55:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:55:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:55:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:55:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:55:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:55:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:55:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:55:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:56:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:56:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:56:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:56:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:57:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:57:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:57:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:57:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:58:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:58:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:58:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:58:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:07:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 06:07:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 06:07:32] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-03 06:07:32] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 06:07:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:07:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:07:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:07:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:08:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:08:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:08:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:08:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:08:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:08:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:08:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:08:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:09:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:09:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:09:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:09:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:09:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:09:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:09:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:09:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:10:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:10:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:10:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:10:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:11:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:11:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:11:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:11:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:12:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:13:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:13:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:13:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:13:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 07:23:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-03 07:23:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:24:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:24:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:24:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:24:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:24:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:25:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:25:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:25:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:25:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:25:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:25:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:25:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:25:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:26:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:26:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:26:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:26:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:26:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:26:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:26:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:26:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:27:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:27:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:27:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:27:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:27:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:27:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:27:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:27:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:28:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:28:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:28:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:28:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:28:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:28:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:28:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:28:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 05:51:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 05:51:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 05:51:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 05:51:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 05:51:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 05:51:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 05:52:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:52:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:52:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:52:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:52:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:52:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:52:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:52:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:53:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:53:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:53:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:53:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:53:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:53:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:53:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:53:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:54:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:54:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:54:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:54:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:54:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:55:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:55:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:55:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:55:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:56:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:56:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:56:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:56:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:26:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:26:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:26:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:26:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:26:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:26:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:27:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:27:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:27:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:27:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:27:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:27:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:28:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:28:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:29:02] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-04 11:29:02] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-04 11:29:02] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:02] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:03] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:03] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:03] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:03] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:29:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:29:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:29:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:29:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:29:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:29:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:29:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:29:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:29:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:29:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:29:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:29:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:29:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:30:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:30:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:30:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:30:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:30:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:30:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:30:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:30:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:31:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:31:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:31:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:32:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:32:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:32:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:32:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:32:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:32:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:32:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:32:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:33:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:33:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:33:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:33:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:33:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:33:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:33:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:33:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:34:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:34:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:34:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:34:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:34:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:34:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:35:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:35:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:36:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:36:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:36:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:36:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 12:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.username' in 'field list' - SQL: SELECT uta.id, uta.user_id, u.username, u.email,
          uta.tenant_id, t.nome as tenant_name
          FROM user_tenant_access uta
          JOIN users u ON uta.user_id = u.id
          JOIN tenants t ON uta.tenant_id = t.id
          WHERE uta.deleted_at IS NULL
          LIMIT 5
[2025-11-04 12:29:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.username' in 'field list'
[2025-11-04 12:30:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list' - SQL: SELECT id, username, email, deleted_at
              FROM users
              WHERE id = ?
[2025-11-04 12:30:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list'
[2025-11-04 12:30:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list' - SQL: SELECT id, username, email, deleted_at FROM users WHERE id = ?
[2025-11-04 12:30:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
