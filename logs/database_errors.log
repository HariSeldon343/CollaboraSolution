[2025-10-28 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'first_response_time' in 'field list' - SQL: 
        SELECT AVG(first_response_time) as avg_time
        FROM tickets
        WHERE tenant_id = ? AND deleted_at IS NULL
          AND first_response_time IS NOT NULL
    
[2025-10-28 06:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'first_response_time' in 'field list'
[2025-10-28 06:50:08] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous - SQL: 
            SELECT
                assigned_to,
                u.name as assignee_name,
                COUNT(*) as count
            FROM tickets t
            LEFT JOIN users u ON t.assigned_to = u.id AND u.deleted_at IS NULL
            WHERE tenant_id = ? AND deleted_at IS NULL
              AND t.status IN ('open', 'in_progress', 'waiting_response')
            GROUP BY assigned_to, u.name
            ORDER BY count DESC
        
[2025-10-28 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous
[2025-10-28 06:50:18] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-28 06:50:18] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-28 06:50:18] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 06:50:18] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 06:50:19] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 06:50:19] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 07:07:29] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 09:30:34] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 12:49:54] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 14:50:30] [ERROR] Errore commit transazione: There is no active transaction
[2025-10-28 17:01:23] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-28 17:01:23] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-28 17:01:23] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-28 17:01:23] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-28 18:58:52] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`tenant_id`, `user_id`, `action`, `entity_type`, `entity_id`, `description`, `old_values`, `new_values`, `metadata`, `ip_address`, `user_agent`, `session_id`, `request_method`, `request_url`, `severity`, `status`, `created_at`) VALUES (:tenant_id, :user_id, :action, :entity_type, :entity_id, :description, :old_values, :new_values, :metadata, :ip_address, :user_agent, :session_id, :request_method, :request_url, :severity, :status, :created_at)
[2025-10-28 18:58:52] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs`
[2025-10-28 19:04:40] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`tenant_id`, `user_id`, `action`, `entity_type`, `entity_id`, `description`, `old_values`, `new_values`, `metadata`, `ip_address`, `user_agent`, `session_id`, `request_method`, `request_url`, `severity`, `status`, `created_at`) VALUES (:tenant_id, :user_id, :action, :entity_type, :entity_id, :description, :old_values, :new_values, :metadata, :ip_address, :user_agent, :session_id, :request_method, :request_url, :severity, :status, :created_at)
[2025-10-28 19:04:40] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_entity` failed for `collaboranexio`.`audit_logs`
[2025-10-28 19:40:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'TABLE_SCHEMA' in 'where clause' - SQL: SELECT CONSTRAINT_NAME, CHECK_CLAUSE
        FROM information_schema.CHECK_CONSTRAINTS
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME = 'audit_logs'
        ORDER BY CONSTRAINT_NAME
[2025-10-29 06:53:59] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 06:53:59] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 06:53:59] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 06:53:59] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 13:39:15] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 13:39:15] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 13:39:16] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 13:39:16] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 13:39:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:23] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:24] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:26] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 13:39:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: INSERT INTO `file_versions` (`file_id`, `version_number`, `size_bytes`, `storage_path`, `created_by`, `created_at`, `changes_description`) VALUES (:file_id, :version_number, :size_bytes, :storage_path, :created_by, :created_at, :changes_description)
[2025-10-29 13:39:31] [ERROR] Errore insert in file_versions: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-10-29 14:29:53] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 14:29:53] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 14:29:53] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 14:29:53] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW INDEX FROM file_assignments
[2025-10-29 14:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: 
        SELECT CONSTRAINT_NAME
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
    
[2025-10-29 14:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:53:05] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SELECT COUNT(*) as total FROM `workflow_roles` WHERE `deleted_at` IS NULL
[2025-10-29 14:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW TABLES LIKE ?
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SHOW INDEX FROM file_assignments
[2025-10-29 14:54:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: 
        SELECT CONSTRAINT_NAME
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
    
[2025-10-29 14:54:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 14:54:17] [ERROR] Errore query: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute. - SQL: SELECT COUNT(*) as total FROM `workflow_roles` WHERE `deleted_at` IS NULL
[2025-10-29 14:54:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 15:50:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 15:50:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'DELETE_RULE' in 'field list' - SQL: 
        SELECT
            TABLE_NAME,
            COLUMN_NAME,
            CONSTRAINT_NAME,
            REFERENCED_TABLE_NAME,
            REFERENCED_COLUMN_NAME,
            DELETE_RULE,
            UPDATE_RULE
        FROM information_schema.KEY_COLUMN_USAGE
        WHERE TABLE_SCHEMA = 'collaboranexio'
        AND TABLE_NAME IN ('file_assignments', 'workflow_roles', 'document_workflow', 'document_workflow_history')
        AND REFERENCED_TABLE_NAME IS NOT NULL
        ORDER BY TABLE_NAME, CONSTRAINT_NAME
    
[2025-10-29 15:50:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'DELETE_RULE' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:19:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:19:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:19:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:19:54] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 19:19:54] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 19:19:55] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 19:19:55] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 19:20:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:20:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:20:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:20:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:20:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:20:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:21:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:21:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:21:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:21:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:21:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:21:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:21:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:21:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:22:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:22:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:22:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:22:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:22:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:22:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:22:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:22:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:24:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:24:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:24:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:24:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:25:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:25:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:25:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:25:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:31:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:31:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:31:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:32:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:32:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:32:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:33:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:33:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:33:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:34:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:34:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:34:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:36:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:36:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:36:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:36:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:36:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:37:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:37:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:37:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:37:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 19:43:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 19:43:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 19:43:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 19:43:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:43:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:43:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:43:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:44:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:44:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:44:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:44:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:44:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:44:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:44:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:44:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:45:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:45:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:45:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:45:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:45:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:45:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:45:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:45:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:46:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:46:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:47:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:47:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:47:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:47:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:48:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:48:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:48:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:48:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 19:49:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 19:49:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 19:49:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 19:49:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-29 20:58:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-29 20:58:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-29 20:58:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-29 20:58:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:42] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-10-29 20:58:42] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-10-29 20:58:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-10-29 20:58:43] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-10-29 20:58:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:58:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-29 20:58:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-29 20:59:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:59:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:59:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:59:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 20:59:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 20:59:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 20:59:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 20:59:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:00:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:00:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:00:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:00:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:00:15] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1 - SQL: SHOW TABLES LIKE ?
[2025-10-29 21:00:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?' at line 1
[2025-10-29 21:00:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:00:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:00:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:00:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:01:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:01:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:01:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:01:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:01:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:01:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:01:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:01:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:03:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:03:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:03:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:03:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-29 21:04:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-29 21:04:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-29 21:04:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-29 21:04:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 10:12:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 10:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 10:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 10:12:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 10:12:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 10:12:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 10:12:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 10:13:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:13:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:13:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:13:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:13:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:13:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:13:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:13:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:14:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:14:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:14:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:14:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:14:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:14:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:14:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:14:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:15:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:15:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:15:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:15:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:15:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:15:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:15:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:15:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:17:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:17:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:17:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:17:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 10:18:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 10:18:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 10:18:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 10:18:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 11:52:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 11:52:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 11:52:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 11:52:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 11:52:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 11:52:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:52:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:52:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:52:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:53:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:53:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:53:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:53:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:53:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:53:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:53:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:53:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:54:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:54:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:54:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:54:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:54:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:54:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:54:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:54:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:55:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:55:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:56:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:56:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:56:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:56:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:57:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:57:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:57:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:57:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:58:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:58:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 11:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 11:59:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 11:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 11:59:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:10:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:10:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:10:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:10:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:10:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:10:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:10:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:11:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:11:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:11:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:11:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:11:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:11:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:11:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:11:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:12:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:12:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:12:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:12:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:12:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:12:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:12:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:12:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:13:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:13:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:13:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:13:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:14:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:14:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:14:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:14:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:15:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:15:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:15:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:15:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:16:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:16:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:16:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:16:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:30:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:30:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:30:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:30:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:30:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:31:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:31:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:31:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:31:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:32:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:32:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:32:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:32:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:32:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:32:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:32:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:32:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:33:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:33:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:33:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:33:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:33:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:33:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:33:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:33:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:35:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:35:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:35:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:35:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:36:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:36:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:36:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:36:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 12:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 12:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 12:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 12:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 12:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:43:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:43:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:43:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:43:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:43:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:43:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:44:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:44:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:44:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:44:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:44:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:45:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:45:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:45:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:45:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:46:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:46:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:46:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:46:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:47:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:47:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 12:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 12:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 12:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 12:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:06:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:06:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:06:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:06:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:06:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:07:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:07:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:07:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:07:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 13:07:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 13:07:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 13:07:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 13:07:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 13:07:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 13:08:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:08:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:08:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:08:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:08:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:08:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:08:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:08:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:09:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:09:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:09:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:09:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:09:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:09:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:09:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:09:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:10:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:10:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:10:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:10:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:10:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:10:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:10:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:10:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:11:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:11:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:11:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:11:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:12:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:12:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:12:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:12:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 13:13:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 13:13:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 13:13:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 13:13:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:32:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:32:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:32:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:32:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 14:32:57] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 14:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:33:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:33:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:33:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:33:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:33:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:33:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:34:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:34:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:34:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:34:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:35:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:35:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:35:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:35:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:37:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:37:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:37:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:37:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:38:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:38:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:38:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:38:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:39:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:39:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:39:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:39:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:39:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:39:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:39:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:40:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:40:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:40:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:40:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:40:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:40:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:40:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:40:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:41:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:41:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:41:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:41:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:41:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:41:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:41:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:41:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:42:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:42:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:42:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:42:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:43:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:43:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:43:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:43:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:44:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:44:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:44:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:44:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:44:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:45:04] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:45:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:45:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:45:34] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:45:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:45:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:46:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:46:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:46:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:46:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:46:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:47:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:47:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:47:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:49:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:49:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:49:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:49:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:50:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:50:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:50:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:50:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:51:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:51:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:51:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:51:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-30 14:53:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-30 14:53:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-30 14:53:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-30 14:54:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-30 14:54:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-30 14:54:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:54:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:54:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:54:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:54:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:54:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:54:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:54:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:55:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:55:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:55:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:55:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:55:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:55:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:55:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:55:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:56:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:56:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:56:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:56:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:56:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:56:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:56:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:56:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:58:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:58:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:58:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 14:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 14:59:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 14:59:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 14:59:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-30 15:00:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-30 15:00:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-30 15:00:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-30 15:00:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-10-31 09:36:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-10-31 09:36:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-10-31 09:36:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-10-31 09:36:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-10-31 09:36:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-10-31 09:36:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:36:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:36:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:36:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:37:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:37:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:37:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:37:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:37:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:38:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:38:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:38:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:38:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:38:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:39:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:39:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:39:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:39:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:40:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:40:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:40:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:40:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:41:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:41:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:41:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:41:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:42:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:42:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:42:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:42:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-10-31 09:43:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-10-31 09:43:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-10-31 09:43:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-10-31 09:43:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:41:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:41:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:41:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 10:41:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:41:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:42:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:42:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:42:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:42:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:42:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:42:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:42:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:42:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:42:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:42:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:43:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:43:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:43:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:43:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:43:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:43:57] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:43:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:43:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:44:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:44:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:44:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:44:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 10:44:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 10:44:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 10:44:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 10:44:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 10:45:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:45:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:45:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:45:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:45:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:45:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:45:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:45:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:46:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:46:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:46:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:46:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:46:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:46:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:46:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:46:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:47:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:47:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:47:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:47:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:47:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:47:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:47:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:47:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:48:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:48:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:48:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:48:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:49:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:49:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:49:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:49:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 10:50:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 10:50:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 10:50:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 10:50:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:38:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:38:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:38:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:38:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:38:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:38:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:38:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:38:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:38:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:38:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:38:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:38:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:38:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:38:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:39:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:39:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:39:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:39:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:39:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:39:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:39:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:39:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:40:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:40:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:40:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:40:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:40:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:40:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:40:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:40:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 13:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 13:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 13:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 13:41:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 13:41:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 13:42:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:42:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:42:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:42:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:42:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:42:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:42:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:42:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:43:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:43:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:43:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:43:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:43:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:43:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:43:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:43:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:44:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:44:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:44:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:44:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:44:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:44:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:44:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:44:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:45:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:45:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:45:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:45:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:46:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:46:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:46:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:46:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 13:47:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 13:47:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 13:47:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 13:47:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 14:24:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 14:24:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 14:24:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 14:24:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 14:24:20] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 14:24:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:24:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:24:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:24:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:25:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:25:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:25:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:25:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:25:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:25:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:25:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:25:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:26:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:26:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:26:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:26:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:26:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:26:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:26:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:26:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:27:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:27:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:27:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:27:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:28:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:28:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:28:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:28:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:29:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:29:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:29:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:29:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:30:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:30:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:30:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:30:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 14:31:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 14:31:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 14:31:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 14:31:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:27:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:27:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:27:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:27:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:27:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:28:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:28:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:28:41] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-01 17:28:41] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-01 17:28:42] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:42] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:42] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:42] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-01 17:28:43] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-01 17:28:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-01 17:28:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-01 17:28:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-01 17:29:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:29:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:29:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:29:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:29:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-01 17:29:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-01 17:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:29:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:29:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:30:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:30:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:30:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:30:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:30:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:30:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:30:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:30:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:31:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:31:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:31:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:31:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:31:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:31:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:31:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:31:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:32:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:32:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:32:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:32:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:33:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:33:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:33:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:34:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:34:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:34:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:35:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:35:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:35:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-01 17:36:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-01 17:36:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-01 17:36:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-01 17:36:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 06:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 06:18:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 06:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT u.id, u.name, u.email, uta.role
         FROM users u
         JOIN user_tenant_access uta ON u.id = uta.user_id
         WHERE u.id = ?
           AND uta.tenant_id = ?
           AND u.deleted_at IS NULL
           AND uta.deleted_at IS NULL
[2025-11-02 06:19:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:19:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:19:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:19:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:19:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:19:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:19:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:20:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:20:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:20:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:20:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:20:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:20:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:20:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:20:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:21:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:21:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:21:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:21:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:21:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:21:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:22:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:22:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:23:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:23:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:24:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:24:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:25:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:25:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 06:35:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 06:35:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 06:35:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 06:35:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:35:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 06:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 06:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
          AND u.id NOT IN (
              SELECT DISTINCT user_id
              FROM workflow_roles
              WHERE tenant_id = ?
                AND deleted_at IS NULL
                AND is_active = 1
          )
        ORDER BY u.name ASC
[2025-11-02 06:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 06:35:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 06:35:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 06:35:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:35:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:35:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:35:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:36:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:36:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:36:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:36:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:36:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:36:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:36:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:36:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:37:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:37:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:37:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:37:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:37:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:37:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:37:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:37:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:38:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:38:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:38:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:38:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:39:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:39:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:39:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:39:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:40:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:40:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:40:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:40:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 06:41:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 06:41:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 06:41:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 06:41:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:12:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:12:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:12:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:12:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:12:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:12:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:12:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:12:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:12:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:13:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:13:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:13:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:13:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:13:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:13:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:13:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:13:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:14:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:14:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:14:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:14:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:15:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:15:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:15:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:15:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:15:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:15:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:15:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:15:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:15:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:15:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:16:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:16:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:17:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:17:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:17:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:17:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:18:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:18:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:18:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:18:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:19:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:19:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:19:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:19:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:20:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:20:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:41:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:41:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:41:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:41:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:41:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:41:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:41:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:42:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:42:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:42:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:42:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:42:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:43:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:43:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:43:50] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-02 08:43:50] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-02 08:43:51] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-02 08:43:51] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-02 08:43:51] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-02 08:43:51] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:43:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:43:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:43:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:44:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:44:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:44:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:44:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:44:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:44:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:44:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:44:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:45:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 08:45:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 08:45:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 08:45:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 08:45:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 08:45:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 08:45:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 08:45:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 08:45:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 08:45:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 10:16:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 10:16:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 10:16:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 10:16:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 10:16:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 10:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 10:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 10:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 10:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 10:17:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:17:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:17:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:17:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:17:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:17:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:18:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:18:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:18:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:18:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:19:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:19:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:19:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:19:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:19:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:20:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:20:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:20:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:21:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:21:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 10:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 10:22:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 10:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 10:22:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:20:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:20:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:20:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:20:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:20:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:20:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:20:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:20:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:20:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:21:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:21:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:21:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:21:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:21:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:21:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:21:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:21:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:22:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:22:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:22:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:22:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:22:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:22:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:22:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:22:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:23:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:23:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:23:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:23:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:23:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:23:30] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:23:30] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:23:30] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:24:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:24:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:24:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:25:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:25:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:25:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:26:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:26:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:26:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:26:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:48:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:48:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:48:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:48:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:48:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-02 17:48:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-02 17:48:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-02 17:48:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-02 17:48:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-02 17:48:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-02 17:49:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:49:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:49:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:49:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:49:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:49:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:49:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:49:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:50:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:50:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:50:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:50:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:51:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:51:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:51:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:51:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:52:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:52:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:52:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:52:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:53:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:53:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:53:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:53:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-02 17:54:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-02 17:54:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-02 17:54:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-02 17:54:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list' - SQL: SELECT DISTINCT
        u.id as user_id,
        u.name as user_name,
        u.email as user_email,
        u.profile_image,
        uta.role as system_role,
        GROUP_CONCAT(
            DISTINCT wr.workflow_role
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as workflow_roles,
        GROUP_CONCAT(
            DISTINCT CONCAT(wr.workflow_role, ':', wr.is_active)
            ORDER BY wr.workflow_role
            SEPARATOR ','
        ) as role_status

    FROM workflow_roles wr
    INNER JOIN users u ON wr.user_id = u.id
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id AND uta.tenant_id = wr.tenant_id
    WHERE wr.tenant_id = ?
      AND wr.deleted_at IS NULL
      AND u.deleted_at IS NULL
      AND uta.deleted_at IS NULL AND wr.is_active = 1 GROUP BY u.id, u.name, u.email, u.profile_image, uta.role
                ORDER BY u.name ASC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.profile_image' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list' - SQL: SELECT
            u.id,
            u.name,
            u.email,
            uta.role as system_role,
            -- Indicators for existing workflow roles (for UI feedback)
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'validator'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_validator,
            CASE
                WHEN EXISTS (
                    SELECT 1 FROM workflow_roles wr
                    WHERE wr.user_id = u.id
                      AND wr.tenant_id = ?
                      AND wr.workflow_role = 'approver'
                      AND wr.deleted_at IS NULL
                      AND wr.is_active = 1
                ) THEN 1 ELSE 0
            END as is_approver
        FROM users u
        INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        WHERE uta.tenant_id = ?
          AND u.deleted_at IS NULL
          AND uta.deleted_at IS NULL
        ORDER BY u.name ASC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uta.role' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 05:53:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 05:53:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 05:53:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 05:53:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-03 05:53:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 05:53:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:53:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:53:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:53:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:54:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:54:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:54:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:54:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:54:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:54:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:54:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:54:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:55:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:55:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:55:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:55:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:55:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:55:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:55:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:55:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:56:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:56:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:56:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:56:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:57:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:57:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:57:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:57:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 05:58:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 05:58:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 05:58:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 05:58:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:07:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 06:07:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 06:07:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 06:07:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 06:07:32] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-03 06:07:32] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 06:07:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:07:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:07:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:07:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:08:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:08:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:08:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:08:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:08:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:08:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:08:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:08:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:09:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:09:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:09:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:09:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:09:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:09:45] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:09:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:09:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:10:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:10:15] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:10:15] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:10:15] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:11:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:11:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:11:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:11:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:12:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:12:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:12:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 06:13:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 06:13:29] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 06:13:29] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 06:13:29] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-03 07:23:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-03 07:23:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-03 07:23:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-03 07:23:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-03 07:23:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-03 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:24:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:24:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:24:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:24:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:24:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:25:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:25:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:25:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:25:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:25:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:25:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:25:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:25:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:26:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:26:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:26:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:26:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:26:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:26:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:26:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:26:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:27:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:27:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:27:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:27:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:27:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:27:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:27:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:27:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:28:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:28:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:28:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:28:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-03 07:28:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-03 07:28:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-03 07:28:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-03 07:28:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 05:51:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 05:51:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 05:51:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 05:51:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 05:51:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 05:51:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 05:51:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 05:51:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 05:51:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 05:52:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:52:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:52:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:52:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:52:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:52:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:52:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:52:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:53:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:53:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:53:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:53:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:53:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:53:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:53:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:53:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:54:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:54:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:54:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:54:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:54:38] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:55:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:55:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:55:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:55:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 05:56:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 05:56:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 05:56:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 05:56:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:26:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:26:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:26:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:26:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:26:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:26:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:26:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:26:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:26:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:27:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:27:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:27:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:27:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:27:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:27:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:28:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:28:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:29:02] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-04 11:29:02] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-04 11:29:02] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:02] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:03] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:03] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:03] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-04 11:29:03] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-04 11:29:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:29:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:29:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:29:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:29:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:29:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:29:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:29:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:29:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:29:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:29:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:29:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:29:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:29:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:29:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:29:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:30:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:30:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:30:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:30:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:30:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:30:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:30:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:30:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list' - SQL: SELECT id, display_name AS name, email, role AS system_role
             FROM users
             WHERE tenant_id = ? AND status = 'active' AND deleted_at IS NULL
             ORDER BY display_name ASC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'display_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list' - SQL: SELECT wr.user_id, wr.role AS workflow_role, 
                        u.display_name AS user_name, u.email AS user_email, u.role AS system_role
                 FROM workflow_roles wr
                 JOIN users u ON u.id = wr.user_id
                 WHERE wr.tenant_id = ? AND u.deleted_at IS NULL
                 ORDER BY u.display_name ASC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'wr.role' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 11:31:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 11:31:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 11:31:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 11:31:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 11:31:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 11:31:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:31:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:31:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:31:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:32:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:32:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:32:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:32:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:32:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:32:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:32:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:32:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:33:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:33:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:33:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:33:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:33:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:33:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:33:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:33:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:34:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:34:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:34:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:34:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:34:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:34:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:34:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:35:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:35:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:35:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 11:36:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 11:36:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 11:36:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 11:36:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 12:29:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.username' in 'field list' - SQL: SELECT uta.id, uta.user_id, u.username, u.email,
          uta.tenant_id, t.nome as tenant_name
          FROM user_tenant_access uta
          JOIN users u ON uta.user_id = u.id
          JOIN tenants t ON uta.tenant_id = t.id
          WHERE uta.deleted_at IS NULL
          LIMIT 5
[2025-11-04 12:29:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.username' in 'field list'
[2025-11-04 12:30:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list' - SQL: SELECT id, username, email, deleted_at
              FROM users
              WHERE id = ?
[2025-11-04 12:30:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list'
[2025-11-04 12:30:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list' - SQL: SELECT id, username, email, deleted_at FROM users WHERE id = ?
[2025-11-04 12:30:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'username' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:12:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:12:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:12:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 15:13:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 15:13:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 15:13:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 15:13:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 15:13:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 15:13:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:13:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:13:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:13:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:14:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:14:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:14:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:14:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:14:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:14:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:14:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:14:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:15:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:15:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:15:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:15:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:15:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:15:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:15:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:15:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:16:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:16:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:16:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:16:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:16:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:16:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:16:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:16:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:17:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:17:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:17:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:17:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:18:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:18:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:18:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:18:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:19:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:19:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:19:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:19:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:20:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:20:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 15:21:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 15:21:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 15:21:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 15:21:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 16:14:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:14:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:14:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-04 16:14:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-04 16:14:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-04 16:14:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-04 16:14:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-04 16:14:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list' - SQL: SELECT DISTINCT
                    u.id,
                    u.display_name AS name,
                    u.email,
                    u.role AS system_role,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'validator' THEN wr.id END
                    ) AS validator_role_ids,
                    GROUP_CONCAT(
                        CASE WHEN wr.role = 'approver' THEN wr.id END
                    ) AS approver_role_ids,
                    MAX(CASE WHEN wr.role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
                    MAX(CASE WHEN wr.role = 'approver' THEN 1 ELSE 0 END) AS is_approver
                FROM users u
                LEFT JOIN workflow_roles wr ON wr.user_id = u.id
                    AND wr.tenant_id = ?
                WHERE u.tenant_id = ?
                  AND u.status = 'active'
                  AND u.deleted_at IS NULL
                GROUP BY u.id, u.display_name, u.email, u.role
                ORDER BY u.display_name ASC
[2025-11-04 16:14:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.display_name' in 'field list'
[2025-11-04 16:14:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-04 16:14:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-04 16:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:14:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:14:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:14:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:15:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:15:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:15:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:15:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:15:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:15:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:16:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:16:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:16:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:16:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:16:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:16:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:16:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:17:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:17:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:17:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:17:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:17:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:18:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:18:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:18:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:18:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-04 16:19:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-04 16:19:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-04 16:19:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-04 16:19:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:53:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:53:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:53:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:53:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:53:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 06:53:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 06:53:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 06:53:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 06:53:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 06:53:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 06:53:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:53:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:53:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:53:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:53:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 06:53:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 06:53:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 06:53:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 06:53:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 06:53:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 06:53:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:53:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:53:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:53:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:54:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:54:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:54:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:54:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:54:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:54:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:54:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:54:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:55:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:55:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:55:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:55:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:55:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:55:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:55:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:55:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:56:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:56:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:56:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:56:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:56:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:56:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:56:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:56:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:57:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:57:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:57:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:57:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 06:58:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 06:58:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 06:58:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 06:58:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:27:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:27:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 07:27:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 07:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 07:27:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 07:27:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 07:27:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 07:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:28:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:28:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:28:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:28:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:28:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:28:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:29:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:29:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:29:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:29:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:29:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:29:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:29:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:29:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:30:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:30:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:30:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:30:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:30:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:30:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:30:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:30:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:31:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:31:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:32:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:32:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 07:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 07:33:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 07:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 07:33:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 13:57:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 13:57:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 13:57:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 13:57:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 13:57:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 13:57:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 13:57:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 13:57:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 13:57:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 13:57:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 13:58:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 13:58:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 13:58:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 13:58:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 13:58:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 13:58:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 13:58:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 13:58:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 13:59:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 13:59:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 13:59:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 13:59:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 13:59:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 13:59:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 13:59:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 13:59:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 14:00:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 14:00:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 14:00:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 14:00:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 14:00:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 14:00:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 14:00:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 14:00:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 14:01:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 14:01:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 14:01:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 14:01:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 14:02:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 14:02:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 14:02:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 14:02:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 16:18:04] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
                    u.id,
                    u.name,
                    u.email,
                    u.role AS system_role
                FROM users u
                INNER JOIN user_tenant_access uta ON u.id = uta.user_id
                    AND uta.tenant_id = ?
                    AND uta.deleted_at IS NULL
                WHERE u.deleted_at IS NULL
                  AND u.status = 'active'
                ORDER BY u.name ASC
                LIMIT 5
[2025-11-05 16:18:04] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:31:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
                    u.id,
                    u.name,
                    u.email,
                    u.role AS system_role
                FROM users u
                INNER JOIN user_tenant_access uta ON u.id = uta.user_id
                    AND uta.tenant_id = ?
                    AND uta.deleted_at IS NULL
                WHERE u.deleted_at IS NULL
                  AND u.status = 'active'
                ORDER BY u.name ASC
                LIMIT 5
[2025-11-05 16:31:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:33:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
                    u.id,
                    u.name,
                    u.email,
                    u.role AS system_role
                FROM users u
                INNER JOIN user_tenant_access uta ON u.id = uta.user_id
                    AND uta.tenant_id = ?
                    AND uta.deleted_at IS NULL
                WHERE u.deleted_at IS NULL
                  AND u.status = 'active'
                ORDER BY u.name ASC
                LIMIT 5
[2025-11-05 16:33:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:33:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 16:33:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 16:33:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 16:33:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 16:33:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:33:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 16:33:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 16:33:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:33:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:33:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 16:33:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 16:33:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 16:33:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 16:33:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:33:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 16:33:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 16:33:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:33:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:34:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 16:34:21] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 16:34:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 16:34:21] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 16:34:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 16:34:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 16:34:21] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 16:34:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        -- Role indicators (boolean flags)
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        -- Role IDs (comma-separated, for removal operations)
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'validator' THEN wr.id END
        ) AS validator_role_ids,
        GROUP_CONCAT(
            CASE WHEN wr.workflow_role = 'approver' THEN wr.id END
        ) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:34:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 16:54:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'where clause' - SQL: SELECT id, name, email, role, tenant_id
         FROM users
         WHERE deleted_at IS NULL
         AND status = 'active'
         ORDER BY name
[2025-11-05 16:54:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'where clause'
[2025-11-05 16:54:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'where clause' - SQL: SELECT id, name, email, tenant_id
         FROM users
         WHERE role = 'super_admin'
         AND deleted_at IS NULL
         AND status = 'active'
[2025-11-05 16:54:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'where clause'
[2025-11-05 16:57:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'field list' - SQL: SELECT id, name, email, role, status, deleted_at
         FROM users
         WHERE tenant_id = ?
         ORDER BY name
[2025-11-05 16:57:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'status' in 'field list'
[2025-11-05 16:57:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause' - SQL: SELECT DISTINCT
        u.id,
        u.name,
        u.email,
        u.role AS system_role,
        MAX(CASE WHEN wr.workflow_role = 'validator' THEN 1 ELSE 0 END) AS is_validator,
        MAX(CASE WHEN wr.workflow_role = 'approver' THEN 1 ELSE 0 END) AS is_approver,
        GROUP_CONCAT(CASE WHEN wr.workflow_role = 'validator' THEN wr.id END) AS validator_role_ids,
        GROUP_CONCAT(CASE WHEN wr.workflow_role = 'approver' THEN wr.id END) AS approver_role_ids
    FROM users u
    INNER JOIN user_tenant_access uta ON u.id = uta.user_id
        AND uta.tenant_id = ?
        AND uta.deleted_at IS NULL
    LEFT JOIN workflow_roles wr ON wr.user_id = u.id
        AND wr.tenant_id = ?
        AND wr.deleted_at IS NULL
    WHERE u.deleted_at IS NULL
      AND u.status = 'active'
    GROUP BY u.id, u.name, u.email, u.role
    ORDER BY u.name ASC
[2025-11-05 16:57:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'u.status' in 'where clause'
[2025-11-05 17:08:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:08:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:08:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:08:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:08:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 17:08:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 17:08:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 17:08:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 17:08:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 17:08:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 17:08:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:08:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:08:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:08:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:09:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:09:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:09:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:09:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:09:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:09:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:09:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:09:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:10:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:10:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:10:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:10:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:10:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:10:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:10:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:10:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:11:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:11:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:11:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:11:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:11:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:11:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:12:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:12:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:12:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:12:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:13:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:13:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:13:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:13:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:28:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:28:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:28:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:28:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:28:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 17:28:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 17:28:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 17:28:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 17:28:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 17:28:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 17:28:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:28:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:28:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:28:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:29:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:29:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:29:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:29:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:29:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:29:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:29:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:29:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:30:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:30:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:30:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:30:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:30:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:30:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:30:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:30:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:31:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:31:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:31:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:31:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:31:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:31:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:32:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:32:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 17:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 17:33:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 17:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 17:33:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 19:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 19:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 19:28:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 19:28:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 19:28:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 19:29:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:29:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:29:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:29:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:29:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:29:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:29:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:29:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:30:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:30:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:30:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:30:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:30:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:30:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:30:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:30:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:31:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:31:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:31:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:31:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:31:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:31:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:31:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:31:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:32:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:32:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:32:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:32:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:32:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:32:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:32:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:32:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:33:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:33:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:33:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:33:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 19:33:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 19:33:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 19:33:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 19:33:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:20:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:20:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 20:20:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 20:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 20:20:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 20:20:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 20:20:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 20:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:21:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:21:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:21:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:21:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:21:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:21:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:21:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:22:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:22:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:22:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:22:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:22:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:22:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:22:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:23:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:23:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:23:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:23:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:23:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:23:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:23:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:24:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:24:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:24:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:24:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:25:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:25:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:25:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:25:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:26:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:26:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:26:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:26:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:38:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:38:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-05 20:38:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 20:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-05 20:38:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-05 20:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-05 20:38:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-05 20:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:39:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:39:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:39:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:39:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:40:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:40:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:40:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:40:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:41:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:41:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:41:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:41:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:41:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:41:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:42:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:42:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:42:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:42:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-05 20:43:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-05 20:43:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-05 20:43:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-05 20:43:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:18:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:18:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:18:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:18:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:18:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-07 06:18:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-07 06:18:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-07 06:18:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-07 06:18:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-07 06:18:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-07 06:19:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:19:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:19:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:19:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:19:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:19:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:19:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:19:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:20:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:20:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:20:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:20:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:20:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:20:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:20:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:20:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:21:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:21:22] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:21:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:21:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:21:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:21:52] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:21:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:21:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:23:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:23:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 06:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 06:24:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 06:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 06:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:17:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-07 07:17:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-07 07:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-07 07:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-07 07:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-07 07:17:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-07 07:17:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:17:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:17:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:17:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:17:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:17:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:17:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:17:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:18:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:18:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:18:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:18:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:18:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:18:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:18:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:19:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:19:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:19:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:19:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:19:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:19:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:19:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:20:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:21:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:21:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:21:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:21:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:21:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:22:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:22:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:22:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:22:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:22:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:22:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:22:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:22:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:23:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:23:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:23:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:23:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:23:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-07 07:24:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-07 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-07 07:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-07 07:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-07 07:24:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-07 07:24:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:37:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-09 10:37:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-09 10:37:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 10:37:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-09 10:37:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:38:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:38:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:38:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:38:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-09 10:38:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-09 10:38:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 10:38:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-09 10:38:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-09 10:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:38:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:38:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:38:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:38:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:38:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:39:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:39:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:39:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:39:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:39:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:39:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:39:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:39:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:39:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:40:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:40:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:40:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:40:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:40:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:40:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:40:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:40:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:40:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:41:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:41:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:41:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:41:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:41:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:41:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:41:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:41:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:41:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:41:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:42:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:42:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:42:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:42:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:42:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:42:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:42:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:42:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:43:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 10:43:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 10:43:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 10:43:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:43:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 10:43:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 10:43:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 10:43:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:15:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:15:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:15:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:15:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-09 11:15:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-09 11:15:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 11:15:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-09 11:15:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-09 11:15:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:15:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:15:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:15:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:15:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:15:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:15:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:16:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:16:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:16:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:16:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:16:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:16:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:16:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:16:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:16:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:16:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:16:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:17:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:17:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:17:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:17:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:17:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:17:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:17:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:17:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:17:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:17:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:17:31] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:18:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:18:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:18:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:18:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:18:01] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:19:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:20:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 11:20:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 11:20:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 11:20:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:20:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 11:20:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 11:20:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 11:20:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:13:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:13:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:13:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:13:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-09 12:13:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-09 12:13:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 12:13:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-09 12:13:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-09 12:14:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:14:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:14:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:14:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:14:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:14:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:14:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:14:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:14:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 12:14:27] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 12:14:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 12:14:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 12:14:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 12:14:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 12:14:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:14:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:14:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:14:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:14:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:14:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:14:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:14:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:15:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:15:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:15:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:15:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:15:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:15:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:15:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:15:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:15:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:15:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:15:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:16:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:16:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:16:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:16:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:16:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:16:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:16:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:16:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:16:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:16:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:16:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:17:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:17:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:17:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:17:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:17:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:18:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:18:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:18:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 12:19:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 12:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 12:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 12:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:19:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 12:19:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 12:26:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.created_by' in 'field list' - SQL: SELECT
        f.id,
        f.name,
        f.folder_id,
        f.tenant_id,
        f.created_at,
        f.created_by,
        f.file_type,
        fo.name AS folder_name,
        t.name AS tenant_name
    FROM files f
    LEFT JOIN files fo ON f.folder_id = fo.id
    LEFT JOIN tenants t ON f.tenant_id = t.id
    WHERE f.id IN (104, 105)
    AND f.deleted_at IS NULL
[2025-11-09 12:26:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.created_by' in 'field list'
[2025-11-09 12:26:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dw.validator_user_id' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        dw.current_state,
        dw.created_at,
        dw.validator_user_id,
        dw.approver_user_id,
        u1.name AS validator_name,
        u2.name AS approver_name
    FROM document_workflow dw
    LEFT JOIN users u1 ON dw.validator_user_id = u1.id
    LEFT JOIN users u2 ON dw.approver_user_id = u2.id
    WHERE dw.file_id IN (104, 105)
    AND dw.deleted_at IS NULL
[2025-11-09 12:26:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dw.validator_user_id' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:05:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:05:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:05:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:05:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-09 13:05:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-09 13:05:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-09 13:05:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-09 13:05:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-09 13:05:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 13:05:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 13:05:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 13:05:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 13:05:28] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-09 13:05:28] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-09 13:05:29] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-09 13:05:29] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-09 13:05:29] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-09 13:05:29] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-09 13:05:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 13:05:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 13:05:38] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-09 13:05:38] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-09 13:05:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:05:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:05:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:05:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:05:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:05:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:05:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:05:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:06:20] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:06:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:06:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:06:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:06:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:06:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:06:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:06:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:06:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:06:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:06:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:07:20] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:07:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:07:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:07:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:07:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:07:50] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:07:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:07:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:07:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:07:50] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:07:50] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:08:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:08:20] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:08:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:08:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:08:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:08:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:08:20] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:08:20] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:09:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:09:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:09:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:09:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:09:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:09:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:09:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:09:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:10:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-09 13:10:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-09 13:10:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-09 13:10:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:10:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-09 13:10:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-09 13:10:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-09 13:10:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:05:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:05:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:05:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:05:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 10:05:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 10:05:48] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 10:05:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 10:05:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 10:05:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 10:05:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 10:05:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 10:05:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 10:05:57] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-10 10:05:57] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-10 10:05:58] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-10 10:05:58] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-10 10:06:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 10:06:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 10:06:01] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 10:06:01] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 10:06:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:06:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:06:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:06:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:06:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:06:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:06:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:06:18] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:06:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:06:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:06:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:06:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:06:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:06:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:06:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:06:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:07:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:07:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:07:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:07:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:07:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:07:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:07:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:07:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:07:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:07:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:07:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:08:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:08:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:08:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:08:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:08:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:08:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:08:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:08:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:08:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:08:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:08:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:09:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:10:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:10:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:10:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:10:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:10:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:10:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:10:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:10:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:11:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 10:11:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 10:11:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 10:11:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:11:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 10:11:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 10:11:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 10:11:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:32:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:32:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:32:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:32:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 14:32:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 14:32:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 14:32:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 14:32:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 14:32:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 14:32:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 14:32:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 14:32:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 14:33:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:33:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:33:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:33:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:33:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:33:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:33:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:33:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:33:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:33:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:33:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:33:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:33:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:33:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:33:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:33:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:34:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:34:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:34:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:34:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:34:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:34:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:34:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:34:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:34:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:34:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:34:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:35:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:35:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:36:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:37:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:37:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:37:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:37:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:37:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:37:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:37:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:37:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:38:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 14:38:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 14:38:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 14:38:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:38:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 14:38:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 14:38:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 14:38:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:08:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:08:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:08:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:08:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 15:08:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 15:08:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:08:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 15:08:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 15:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:08:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:08:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:08:48] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:08:48] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:09:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:09:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:09:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:09:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:09:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:09:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:09:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 15:09:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 15:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 15:09:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 15:09:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:09:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:09:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:09:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:09:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:09:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:09:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:09:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:09:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:09:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:09:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:09:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:09:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:09:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:10:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:10:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:10:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:10:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:10:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:10:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:10:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:10:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:10:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:10:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:10:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:10:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:10:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:10:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:10:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:10:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:10:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:10:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:10:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:10:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:10:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:10:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:11:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:11:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:11:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:11:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:11:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:11:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:11:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:11:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:11:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:11:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:11:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:11:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:11:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:11:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:11:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:11:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:11:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:11:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:11:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:11:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:11:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:12:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:12:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:12:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:12:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:12:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:12:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:12:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:12:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:12:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:13:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:13:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:13:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:13:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:13:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:13:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:13:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:13:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:14:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:14:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:14:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:14:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:14:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:14:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:14:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:14:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:15:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:15:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:15:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:15:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:15:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:15:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:15:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:15:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:31:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:31:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:31:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:31:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 15:31:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 15:31:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 15:31:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 15:31:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 15:31:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:31:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:31:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:31:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:31:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:31:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:31:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 15:31:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 15:32:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:32:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:32:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:32:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:32:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:32:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:32:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:32:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:32:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:32:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:32:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:32:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:32:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:32:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:32:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:32:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:33:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:33:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:33:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:33:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:33:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:33:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:33:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:33:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:33:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:33:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:33:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:34:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:34:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:34:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:34:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:34:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:34:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:34:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:34:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:34:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:34:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:34:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:35:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 15:36:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 15:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 15:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 15:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 15:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 15:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:20:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 16:20:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 16:20:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 16:20:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 16:20:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 16:20:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:20:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:20:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:20:07] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:20:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:20:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:20:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:20:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:20:18] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:20:18] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:20:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:20:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:20:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:20:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:20:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:20:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:20:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:21:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:21:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:21:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:21:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:21:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:21:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:21:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:21:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:21:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:21:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:21:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:22:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:22:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:22:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:22:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:22:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:22:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:22:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:22:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:22:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:22:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:22:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:23:06] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:23:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:23:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:23:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:23:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:23:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:23:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:23:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:23:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:23:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:23:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:24:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:24:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:24:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:24:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:24:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:24:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:24:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:24:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:25:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:25:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:25:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:25:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:25:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:25:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:25:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:25:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:30:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 16:30:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 16:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 16:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 16:30:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 16:30:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:30:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:30:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:30:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:31:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 16:31:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 16:31:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:31:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:31:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:31:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:31:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:31:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:31:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:31:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:31:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:31:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:31:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:31:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:31:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:31:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:31:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:31:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:32:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:32:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:32:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:32:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:32:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:32:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:32:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:32:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:32:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:32:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:32:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:33:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:33:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:33:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:33:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:33:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:33:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:33:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:33:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:33:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:33:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:33:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:34:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:34:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:34:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:34:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:34:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:34:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:34:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:34:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:35:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:35:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:35:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 16:36:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 16:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 16:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 16:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 16:36:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 16:36:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 18:56:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: SELECT id, tenant_id, created_by, folder_id FROM files WHERE id IN (104, 105) AND deleted_at IS NULL
[2025-11-10 18:56:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:03:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-10 19:03:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-10 19:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-10 19:03:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 19:03:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 19:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 19:03:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 19:04:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 19:04:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 19:04:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-10 19:04:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-10 19:04:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:04:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:04:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:04:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:04:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:04:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:04:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:04:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:04:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:04:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:04:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:04:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:04:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:04:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:04:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:04:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:05:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:05:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:05:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:05:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:05:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:05:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:05:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:05:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:05:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:05:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:05:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:06:28] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:06:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:06:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:06:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:06:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:06:58] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:06:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:06:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:06:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:06:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:06:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:07:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:07:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:07:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:07:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:07:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:07:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:07:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:07:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:08:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:08:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:08:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:08:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:08:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:08:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:08:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:08:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-10 19:09:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-10 19:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-10 19:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-10 19:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:09:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-10 19:09:59] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-10 19:10:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: 
        SELECT
            id,
            name,
            tenant_id,
            folder_id,
            is_folder,
            created_by,
            created_at
        FROM files
        WHERE tenant_id = 11
          AND deleted_at IS NULL
        ORDER BY id DESC
        LIMIT 20
    
[2025-11-10 19:10:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-10 19:10:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'parent_folder_id' in 'field list' - SQL: 
        SELECT id, name, tenant_id, parent_folder_id, is_folder
        FROM files
        WHERE id = 48
        LIMIT 1
    
[2025-11-10 19:10:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'parent_folder_id' in 'field list'
[2025-11-10 19:11:28] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: 
        SELECT id, name, folder_id, tenant_id, created_by
        FROM files
        WHERE id IN (104, 105)
          AND deleted_at IS NULL
    
[2025-11-10 19:11:28] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-10 19:14:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous - SQL: 
        SELECT f.*,
               u.name as uploaded_by_name,
               CASE
                   WHEN f.is_folder = 1 THEN 'folder'
                   WHEN f.is_editable = 1 THEN 'document'
                   WHEN f.mime_type LIKE 'image/%' THEN 'image'
                   WHEN f.mime_type LIKE 'video/%' THEN 'video'
                   ELSE 'file'
               END as item_type,
               (SELECT COUNT(*) FROM files WHERE folder_id = f.id AND deleted_at IS NULL) as item_count,
               dw.current_state AS workflow_state,
               CASE dw.current_state
                   WHEN 'bozza' THEN 'blue'
                   WHEN 'in_validazione' THEN 'yellow'
                   WHEN 'validato' THEN 'green'
                   WHEN 'in_approvazione' THEN 'orange'
                   WHEN 'approvato' THEN 'green'
                   WHEN 'rifiutato' THEN 'red'
                   ELSE NULL
               END AS workflow_badge_color,
               -- Check if workflow is enabled for this file/folder
               CASE
                   WHEN f.is_folder = 1 THEN
                       get_workflow_enabled_for_folder(f.tenant_id, f.id)
                   ELSE
                       get_workflow_enabled_for_folder(f.tenant_id, f.folder_id)
               END AS workflow_enabled
        FROM files f
        LEFT JOIN users u ON f.uploaded_by = u.id
        LEFT JOIN document_workflow dw ON dw.file_id = f.id
            AND dw.tenant_id = f.tenant_id
            AND dw.deleted_at IS NULL
        WHERE tenant_id = ? AND folder_id = ? AND deleted_at IS NULL
        ORDER BY f.is_folder DESC, f.name ASC
        LIMIT ? OFFSET ?
    
[2025-11-10 19:14:43] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'tenant_id' in where clause is ambiguous
[2025-11-10 19:14:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'size' in 'field list' - SQL: 
        SELECT
            COUNT(*) as total_files,
            SUM(size) as total_size,
            COUNT(CASE WHEN is_folder = 1 THEN 1 END) as total_folders
        FROM files
        WHERE tenant_id = ? AND deleted_at IS NULL
    
[2025-11-10 19:14:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'size' in 'field list'
[2025-11-11 06:02:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: SELECT id, name, tenant_id, folder_id, is_folder, created_by, created_at
     FROM files
     WHERE tenant_id = 11 AND deleted_at IS NULL AND is_folder = 0
     ORDER BY id DESC
[2025-11-11 06:02:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-11 06:02:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.created_by' in 'field list' - SQL: INSERT INTO document_workflow (tenant_id, file_id, current_state, created_by_user_id, created_at, updated_at)
SELECT f.tenant_id, f.id, 'bozza', f.created_by, NOW(), NOW()
FROM files f
LEFT JOIN document_workflow dw ON dw.file_id = f.id AND dw.deleted_at IS NULL
WHERE f.tenant_id = 11
  AND f.is_folder = 0
  AND f.deleted_at IS NULL
  AND dw.id IS NULL
[2025-11-11 06:03:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: SELECT id, name, tenant_id, folder_id, is_folder, created_by, created_at
     FROM files
     WHERE tenant_id = 11 AND deleted_at IS NULL AND is_folder = 0
     ORDER BY id DESC
[2025-11-11 06:03:00] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-11 06:03:22] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_workflow_settings_scope_consistency` failed for `collaboranexio`.`workflow_settings` - SQL: UPDATE `workflow_settings` SET `folder_id` = :set_folder_id WHERE `id` = :where_id
[2025-11-11 06:03:22] [ERROR] Errore update in workflow_settings: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_workflow_settings_scope_consistency` failed for `collaboranexio`.`workflow_settings`
[2025-11-11 06:03:35] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_workflow_settings_scope_consistency` failed for `collaboranexio`.`workflow_settings` - SQL: UPDATE workflow_settings SET folder_id = 48 WHERE id = 1
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:12:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:12:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:12:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:12:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-11 06:12:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-11 06:12:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:12:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-11 06:12:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-11 06:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:12:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:12:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:12:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:12:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:12:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:13:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:13:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:13:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:13:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:13:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:13:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:13:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:13:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:13:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:13:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:13:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:14:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:14:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:14:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:14:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:14:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:14:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:14:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:14:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:14:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:14:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:14:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:15:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:15:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:15:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:15:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:15:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:15:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:15:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:15:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:15:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:15:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:15:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:17:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:17:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:17:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:18:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:18:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:18:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:19:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:19:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:19:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-11 06:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-11 06:50:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:50:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-11 06:50:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-11 06:50:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:50:39] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:50:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:50:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:50:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:39] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:50:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:50:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:50:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-11 06:50:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:50:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-11 06:50:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 06:50:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-11 06:50:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-11 06:50:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:50:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 06:50:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 06:51:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:51:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:51:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:51:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:51:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:51:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:51:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:51:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:51:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:51:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:51:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:51:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:51:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:51:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:51:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:51:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:52:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:52:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:52:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:52:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:52:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:52:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:52:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:52:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:52:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:52:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:52:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:53:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:53:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:53:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:53:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:53:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:53:54] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:53:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:53:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:53:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:53:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:53:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:55:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:55:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:55:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:55:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:55:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:56:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 06:56:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 06:56:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 06:56:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:56:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 06:56:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 06:56:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 06:56:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:06:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:06:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:06:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:06:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-11 07:06:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-11 07:06:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 07:06:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-11 07:06:41] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-11 07:06:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 07:06:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 07:06:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 07:06:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 07:06:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 07:06:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 07:06:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 07:06:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 07:06:43] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id, file_size, mime_type, tenant_id
             FROM files
             WHERE id = ? AND deleted_at IS NULL
[2025-11-11 07:06:43] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-11 07:07:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:07:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:07:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:07:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:07:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:07:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:07:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:07:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:07:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:07:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:07:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:07:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:07:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:07:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:07:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:07:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:08:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:08:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:08:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:08:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:08:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:08:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:08:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:08:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:08:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:08:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:09:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:09:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:09:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:09:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:09:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:11:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:11:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:11:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:11:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:11:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:12:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 07:12:05] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 07:12:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 07:12:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:12:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 07:12:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 07:12:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 07:12:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:10:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:10:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:10:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:10:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-11 16:10:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-11 16:10:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-11 16:10:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-11 16:10:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-11 16:10:57] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-11 16:10:57] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-11 16:10:57] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-11 16:10:57] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-11 16:10:57] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `new_values`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :new_values, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-11 16:10:57] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-11 16:11:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:11:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:11:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:11:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:11:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:11:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:11:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:11:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:11:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:11:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:11:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:11:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:11:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:11:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:11:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:11:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:12:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:12:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:12:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:12:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:12:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:12:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:12:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:12:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:12:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:12:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:12:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:13:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-11 16:13:25] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-11 16:13:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-11 16:13:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:13:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-11 16:13:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:13:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-11 16:13:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-11 16:13:43] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-11 16:13:43] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-11 16:13:45] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1 - SQL: UPDATE `document_editor_sessions` SET `closed_at` = :set_closed_at WHERE `closed_at` IS NULL AND `last_activity <` = :where_last_activity <
[2025-11-11 16:13:45] [ERROR] Errore update in document_editor_sessions: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
[2025-11-11 16:13:45] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-11 16:13:45] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-11 16:13:49] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs` - SQL: INSERT INTO `audit_logs` (`user_id`, `tenant_id`, `action`, `entity_type`, `entity_id`, `description`, `ip_address`, `user_agent`, `severity`, `status`, `created_at`) VALUES (:user_id, :tenant_id, :action, :entity_type, :entity_id, :description, :ip_address, :user_agent, :severity, :status, :created_at)
[2025-11-11 16:13:49] [ERROR] Errore insert in audit_logs: Errore database: SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `chk_audit_action` failed for `collaboranexio`.`audit_logs`
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:54:02] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:54:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:54:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:54:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-12 05:54:02] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-12 05:54:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-12 05:54:02] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:54:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-12 05:54:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-12 05:54:08] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:08] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-12 05:54:08] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-12 05:54:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:54:13] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:54:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:54:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:54:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:13] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:54:13] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-12 05:54:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-12 05:54:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 05:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-12 05:54:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-12 05:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:54:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:55:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:55:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:56:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:56:44] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:56:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:56:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:56:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:56:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:56:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:57:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:57:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:57:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:57:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:57:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:57:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:57:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:57:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:58:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:58:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:58:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:58:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:58:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:58:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:58:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:58:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:59:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 05:59:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 05:59:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 05:59:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:59:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 05:59:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 05:59:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 05:59:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:02:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:02:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:02:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:02:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-12 06:02:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-12 06:02:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 06:02:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-12 06:02:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-12 06:02:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:02:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:02:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:02:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:02:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:02:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:02:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:03:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:03:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:03:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:03:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:03:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:03:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:03:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:03:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:03:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:03:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:03:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:04:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:04:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:04:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:04:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:04:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:04:47] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:04:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:04:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:04:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:04:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:04:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:05:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:05:17] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:05:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:05:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:05:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:05:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:05:17] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:05:17] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:06:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:06:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:06:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:06:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:06:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:06:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:06:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:06:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:07:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 06:07:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 06:07:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 06:07:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:07:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 06:07:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 06:07:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 06:07:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:42:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:42:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:42:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:42:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-12 08:42:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-12 08:42:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-12 08:42:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-12 08:42:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-12 08:43:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:43:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:43:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:43:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:43:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:43:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:43:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:43:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:43:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:43:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:43:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:43:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:43:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:43:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:43:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:43:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:44:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:44:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:44:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:44:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:44:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:44:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:44:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:44:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:45:12] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:45:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:45:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:45:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:12] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:45:12] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:45:42] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:45:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:45:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:45:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:45:42] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:45:42] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:46:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:46:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:46:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:46:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:46:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:47:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:47:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:47:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:47:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:47:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:47:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:47:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:47:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:48:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list' - SQL: SELECT
        COUNT(*) as total,
        COUNT(CASE WHEN state = ? THEN 1 END) as draft_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_validation_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as validated_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as in_approval_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as approved_count,
        COUNT(CASE WHEN state = ? THEN 1 END) as rejected_count,
        AVG(rejection_count) as avg_rejections,
        AVG(CASE
            WHEN approved_at IS NOT NULL
            THEN TIMESTAMPDIFF(HOUR, submitted_at, approved_at)
            ELSE NULL
        END) as avg_completion_hours
    FROM document_workflow
    WHERE tenant_id = ?
      AND deleted_at IS NULL
[2025-11-12 08:48:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'state' in 'field list'
[2025-11-12 08:48:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-12 08:48:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:48:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-12 08:48:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-12 08:48:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-12 08:48:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:51:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:51:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:51:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 06:51:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 06:51:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 06:51:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 06:51:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:51:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:51:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:51:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 06:51:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 06:51:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 06:51:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 06:51:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 06:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:52:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:52:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:52:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:52:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:52:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:52:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:52:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:52:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:52:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:52:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:53:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:53:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:53:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:53:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:53:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:53:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:53:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:54:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:54:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:27] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:54:27] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:54:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:54:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:54:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:54:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:55:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:55:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:55:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:55:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:55:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:55:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:56:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:56:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:56:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:56:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:56:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:56:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:57:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 06:57:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:57:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 06:57:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 06:57:34] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 06:57:34] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 07:21:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: 
        SELECT COUNT(*) as cnt
        FROM document_workflow_history
        WHERE deleted_at IS NULL
    
[2025-11-13 07:21:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 07:21:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: 
        SELECT COUNT(*) as cnt
        FROM document_workflow_history
        WHERE to_state = 'approvato'
        AND transition_type = 'approve'
        AND deleted_at IS NULL
    
[2025-11-13 07:21:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 07:21:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'h.deleted_at' in 'where clause' - SQL: 
        SELECT 
            h.id,
            h.to_state,
            h.transition_type,
            h.performed_by_user_id,
            u.name as user_name,
            u.email as user_email
        FROM document_workflow_history h
        INNER JOIN users u ON u.id = h.performed_by_user_id AND u.deleted_at IS NULL
        WHERE h.deleted_at IS NULL
        LIMIT 5
    
[2025-11-13 07:21:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'h.deleted_at' in 'where clause'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:39:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:39:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:39:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 14:39:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 14:39:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 14:39:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 14:39:46] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:40:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:40:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:40:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 14:40:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 14:40:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 14:40:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 14:40:16] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 14:40:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:40:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:40:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:40:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:40:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:40:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:41:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:41:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:41:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:41:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:41:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:41:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:41:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:42:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:42:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:42:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:42:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:42:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:42:46] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:42:46] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:43:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:43:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:16] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:43:16] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:43:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:43:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:44:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:44:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:44:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:44:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:45:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:45:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:45:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:45:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:45:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:45:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:46:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 14:46:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:46:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 14:46:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 14:46:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 14:46:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:16:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:16:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:16:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:16:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:16:11] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:16:11] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:16:11] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:16:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:16:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:16:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:41] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:16:41] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:16:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:16:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:16:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:16:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:17:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:17:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:17:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:17:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:17:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:17:09] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:17:09] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:17:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:17:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:17:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:17:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:17:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:17:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:18:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:18:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:18:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:18:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:18:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:19:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:19:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:19:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:19:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:19:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:19:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:19:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:20:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:20:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:20:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:20:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:20:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:20:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:20:40] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:21:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:21:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:21:10] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:21:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:21:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:21:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:21:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:22:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:22:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:22:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:22:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:22:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:22:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:23:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:23:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:23:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:23:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:23:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:23:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:24:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:24:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:24:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:24:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:24:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:24:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:25:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:25:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:25:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:25:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:25:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:25:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:41:31] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: SELECT COUNT(*) as cnt FROM document_workflow_history WHERE deleted_at IS NULL
[2025-11-13 15:41:31] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 15:41:37] [ERROR] Errore query: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.workflow_role_validators' doesn't exist - SQL: SHOW COLUMNS FROM workflow_role_validators
[2025-11-13 15:41:37] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.workflow_role_validators' doesn't exist
[2025-11-13 15:41:37] [ERROR] Errore query: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.workflow_role_validators' doesn't exist - SQL: SHOW COLUMNS FROM workflow_role_validators
[2025-11-13 15:41:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.workflow_role_validators' doesn't exist
[2025-11-13 15:42:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: SELECT COUNT(*) as cnt FROM document_workflow_history WHERE deleted_at IS NULL
[2025-11-13 15:42:19] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:45:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:45:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:45:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:45:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:45:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:45:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:45:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:46:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:46:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:46:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:22] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:46:22] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:46:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:46:35] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:46:35] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:46:35] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:47:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:47:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:47:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:47:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:47:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:47:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:47:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:47:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:47:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:47:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:47:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:47:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:48:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:48:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:48:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:48:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:48:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:48:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:48:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:49:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:49:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:06] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:49:06] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:49:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:49:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:49:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:49:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:50:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:50:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:51:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:51:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:51:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:51:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:51:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:51:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:52:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:52:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:52:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:52:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:52:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:52:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:53:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:53:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:53:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 15:53:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 15:53:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 15:53:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 15:53:14] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 15:53:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:53:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:53:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:53:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:53:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:54:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:54:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:54:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:54:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:54:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:55:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:55:44] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:55:44] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:14] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:56:14] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:56:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:56:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:56:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:56:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:57:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:57:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:57:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 15:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 15:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 15:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 15:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:03:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:03:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:03:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 16:03:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 16:03:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 16:03:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 16:03:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 16:03:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:03:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:03:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:03:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:03:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:04:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:04:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:04:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:04:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:04:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:04:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:04:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:05:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:05:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:05:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:05:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:05:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:05:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:05:56] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:06:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:06:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:06:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:06:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:06:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:06:26] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:07:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:07:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:07:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:07:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:07:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:07:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:08:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 16:08:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:08:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 16:08:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 16:08:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 16:08:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:34:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:34:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:34:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-13 21:34:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-13 21:34:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-13 21:34:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-13 21:34:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-13 21:34:40] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-13 21:34:40] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:34:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:34:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:34:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:34:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:34:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:35:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:35:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:35:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:36:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:36:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:36:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:26] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, tenant_id, folder_id, uploaded_by, deleted_at 
     FROM files 
     WHERE id = 105
[2025-11-13 21:36:26] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:36:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, tenant_id, folder_id, uploaded_by, deleted_at 
     FROM files 
     WHERE folder_id = 48 AND deleted_at IS NULL
     ORDER BY id DESC
[2025-11-13 21:36:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:36:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, tenant_id, folder_id, uploaded_by, deleted_at 
     FROM files 
     WHERE id = 105
[2025-11-13 21:36:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:36:47] [ERROR] Errore query: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?%" OR change_details LIKE "%file_id": 105%")
     ORDER BY created_at DESC
 ...' at line 3 - SQL: SELECT * FROM audit_logs 
     WHERE (entity_type = "file" AND entity_id = 105)
        OR (change_details LIKE "%file_id":105%" OR change_details LIKE "%file_id": 105%")
     ORDER BY created_at DESC
     LIMIT 10
[2025-11-13 21:36:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '?%" OR change_details LIKE "%file_id": 105%")
     ORDER BY created_at DESC
 ...' at line 3
[2025-11-13 21:36:47] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, tenant_id, folder_id, created_at, deleted_at
     FROM files
     WHERE tenant_id = 11
     ORDER BY id DESC
     LIMIT 5
[2025-11-13 21:36:47] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:36:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:36:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:36:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:54] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:36:54] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:36:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, tenant_id, deleted_at FROM files WHERE file_name LIKE "%validazione%"
[2025-11-13 21:36:57] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:37:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:37:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:37:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:37:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:37:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:37:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:38:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:38:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:38:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:38:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:38:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:38:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:39:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.action' in 'field list' - SQL: 
    SELECT
        dwh.id,
        dwh.file_id,
        dwh.action,
        dwh.previous_state,
        dwh.new_state,
        dwh.tenant_id,
        dwh.created_at
    FROM document_workflow_history dwh
    LEFT JOIN files f ON dwh.file_id = f.id AND f.deleted_at IS NULL
    WHERE f.id IS NULL AND dwh.deleted_at IS NULL
    ORDER BY dwh.file_id

[2025-11-13 21:39:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.action' in 'field list'
[2025-11-13 21:39:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.user_id' in 'field list' - SQL: 
    SELECT
        fa.id,
        fa.file_id,
        fa.user_id,
        fa.assigned_by,
        fa.workflow_role,
        fa.tenant_id,
        fa.created_at
    FROM file_assignments fa
    LEFT JOIN files f ON fa.file_id = f.id AND f.deleted_at IS NULL
    WHERE f.id IS NULL AND fa.deleted_at IS NULL
    ORDER BY fa.file_id

[2025-11-13 21:39:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.user_id' in 'field list'
[2025-11-13 21:39:45] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: 
    SELECT
        f.id as file_id,
        f.file_name,
        f.tenant_id,
        f.deleted_at as file_deleted_at,
        dw.id as workflow_id,
        dw.current_state,
        dw.deleted_at as workflow_deleted_at
    FROM files f
    INNER JOIN document_workflow dw ON f.id = dw.file_id
    WHERE f.deleted_at IS NOT NULL
      AND dw.deleted_at IS NULL
    ORDER BY f.id

[2025-11-13 21:39:45] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:39:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:39:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:39:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:39:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:39:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:39:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:40:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: 
    SELECT id, tenant_id, folder_id, file_name, file_path, mime_type, file_size,
           created_at, updated_at, deleted_at
    FROM files
    WHERE id = 105

[2025-11-13 21:40:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:40:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: 
    SELECT id, file_id, tenant_id, current_state, created_by,
           created_at, updated_at, deleted_at
    FROM document_workflow
    WHERE file_id = 105

[2025-11-13 21:40:23] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-13 21:40:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'action' in 'field list' - SQL: 
    SELECT id, file_id, action, previous_state, new_state,
           performed_by, created_at, deleted_at
    FROM document_workflow_history
    WHERE file_id = 105
    ORDER BY created_at DESC

[2025-11-13 21:40:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'action' in 'field list'
[2025-11-13 21:40:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'user_id' in 'field list' - SQL: 
    SELECT id, file_id, user_id, assigned_by, workflow_role,
           created_at, deleted_at
    FROM file_assignments
    WHERE file_id = 105
    ORDER BY created_at DESC

[2025-11-13 21:40:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'user_id' in 'field list'
[2025-11-13 21:40:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-13 21:40:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:40:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-13 21:40:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:40:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-13 21:40:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-13 21:41:05] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: 
    SELECT id, tenant_id, file_path, file_name, file_size
    FROM files
    WHERE deleted_at IS NULL
    ORDER BY tenant_id, id

[2025-11-13 21:41:05] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-13 21:41:39] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous - SQL: 
    SELECT
        CONSTRAINT_NAME,
        COLUMN_NAME,
        REFERENCED_TABLE_NAME,
        REFERENCED_COLUMN_NAME,
        DELETE_RULE,
        UPDATE_RULE
    FROM information_schema.KEY_COLUMN_USAGE
    LEFT JOIN information_schema.REFERENTIAL_CONSTRAINTS USING (CONSTRAINT_NAME, CONSTRAINT_SCHEMA)
    WHERE TABLE_SCHEMA = 'collaboranexio'
      AND TABLE_NAME = 'document_workflow'
      AND REFERENCED_TABLE_NAME IS NOT NULL
    ORDER BY CONSTRAINT_NAME

[2025-11-13 21:41:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous
[2025-11-13 21:41:39] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous - SQL: 
    SELECT
        CONSTRAINT_NAME,
        COLUMN_NAME,
        REFERENCED_TABLE_NAME,
        REFERENCED_COLUMN_NAME,
        DELETE_RULE,
        UPDATE_RULE
    FROM information_schema.KEY_COLUMN_USAGE
    LEFT JOIN information_schema.REFERENTIAL_CONSTRAINTS USING (CONSTRAINT_NAME, CONSTRAINT_SCHEMA)
    WHERE TABLE_SCHEMA = 'collaboranexio'
      AND TABLE_NAME = 'document_workflow_history'
      AND REFERENCED_TABLE_NAME IS NOT NULL
    ORDER BY CONSTRAINT_NAME

[2025-11-13 21:41:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous
[2025-11-13 21:41:39] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous - SQL: 
    SELECT
        CONSTRAINT_NAME,
        COLUMN_NAME,
        REFERENCED_TABLE_NAME,
        REFERENCED_COLUMN_NAME,
        DELETE_RULE,
        UPDATE_RULE
    FROM information_schema.KEY_COLUMN_USAGE
    LEFT JOIN information_schema.REFERENTIAL_CONSTRAINTS USING (CONSTRAINT_NAME, CONSTRAINT_SCHEMA)
    WHERE TABLE_SCHEMA = 'collaboranexio'
      AND TABLE_NAME = 'file_assignments'
      AND REFERENCED_TABLE_NAME IS NOT NULL
    ORDER BY CONSTRAINT_NAME

[2025-11-13 21:41:39] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'REFERENCED_TABLE_NAME' in field list is ambiguous
[2025-11-13 21:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: SELECT COUNT(*) as cnt FROM document_workflow_history WHERE deleted_at IS NULL
[2025-11-13 21:42:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 21:42:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause' - SQL: SELECT COUNT(*) as cnt FROM document_workflow_history WHERE deleted_at IS NOT NULL
[2025-11-13 21:42:00] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'deleted_at' in 'where clause'
[2025-11-13 21:43:33] [ERROR] Errore query: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'TABLE_NAME' in field list is ambiguous - SQL: 
    SELECT
        TABLE_NAME,
        CONSTRAINT_NAME,
        COLUMN_NAME,
        DELETE_RULE
    FROM information_schema.KEY_COLUMN_USAGE kcu
    LEFT JOIN information_schema.REFERENTIAL_CONSTRAINTS rc
        USING (CONSTRAINT_NAME, CONSTRAINT_SCHEMA)
    WHERE kcu.TABLE_SCHEMA = 'collaboranexio'
      AND kcu.COLUMN_NAME = 'file_id'
      AND kcu.TABLE_NAME IN ('document_workflow', 'document_workflow_history', 'file_assignments')
      AND rc.DELETE_RULE = 'CASCADE'

[2025-11-13 21:43:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'TABLE_NAME' in field list is ambiguous
[2025-11-13 21:43:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.deleted_at' in 'where clause' - SQL: 
    SELECT COUNT(*) as cnt
    FROM document_workflow_history dwh
    LEFT JOIN files f ON dwh.file_id = f.id AND f.deleted_at IS NULL
    WHERE f.id IS NULL AND dwh.deleted_at IS NULL

[2025-11-13 21:43:33] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.deleted_at' in 'where clause'
[2025-11-13 21:43:57] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.deleted_at' in 'where clause' - SQL: 
    SELECT COUNT(*) as cnt
    FROM document_workflow_history dwh
    LEFT JOIN files f ON dwh.file_id = f.id AND f.deleted_at IS NULL
    WHERE f.id IS NULL AND dwh.deleted_at IS NULL

[2025-11-13 21:43:57] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'dwh.deleted_at' in 'where clause'
[2025-11-13 21:54:53] [ERROR] Errore query: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist - SQL: SELECT id, nome FROM aziende WHERE id = 11 AND deleted_at IS NULL
[2025-11-13 21:54:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist
[2025-11-13 21:55:02] [ERROR] Errore query: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist - SQL: SELECT id, nome FROM aziende WHERE deleted_at IS NULL ORDER BY id LIMIT 3
[2025-11-13 21:55:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist
[2025-11-13 21:55:09] [ERROR] Errore query: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist - SQL: SELECT f.id, f.file_name, f.tenant_id, a.nome FROM files f JOIN aziende a ON f.tenant_id = a.id WHERE f.deleted_at IS NULL LIMIT 5
[2025-11-13 21:55:09] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S02]: Base table or view not found: 1146 Table 'collaboranexio.aziende' doesn't exist
[2025-11-13 21:59:56] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, tenant_id, folder_id, file_name, deleted_at FROM files WHERE id = 105
[2025-11-13 21:59:56] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:07:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:07:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:07:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 06:07:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 06:07:36] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:07:36] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 06:07:36] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 06:08:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:08:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:08:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:08:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:08:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:08:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:08:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:08:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:08:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:08:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:08:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:08:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:09:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:09:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:09:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:09:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:09:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:09:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:09:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:10:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:10:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:07] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:10:07] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:10:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:10:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:10:37] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:10:37] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:11:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:11:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:11:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:11:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:11:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:11:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:12:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:12:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:12:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:12:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:12:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:12:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:13:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:13:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:13:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:13:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:13:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:13:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:28:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:28:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:28:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 06:28:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 06:28:24] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:28:24] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 06:28:24] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 06:28:32] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-14 06:28:32] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-14 06:28:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:28:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:28:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:28:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:28:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:29:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:29:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:29:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:29:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:29:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:29:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:29:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:30:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:30:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:30:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:30:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:30:55] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:31:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:31:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:25] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:31:25] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:31:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:31:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:31:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:31:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:32:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:32:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:32:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:32:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:33:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:33:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:33:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:33:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:50:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:50:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:50:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 06:50:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 06:50:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:50:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 06:50:49] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 06:50:55] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-14 06:50:55] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-14 06:51:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:51:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:51:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:51:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:51:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:51:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:51:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:51:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:51:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:51:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:51:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:51:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:52:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:52:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:52:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:52:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:52:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:52:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:52:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:53:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:53:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:19] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:53:19] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:53:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:53:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:53:49] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:53:49] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:54:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:54:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:54:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:54:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:54:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:54:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:55:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:55:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:55:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:55:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:55:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:55:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:57:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:57:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:57:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:57:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:57:52] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:57:52] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 06:57:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 06:57:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 06:57:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 06:57:53] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 06:57:59] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-14 06:57:59] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-14 06:58:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:58:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:58:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:58:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:58:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:58:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:58:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:58:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:59:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:59:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:59:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 06:59:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 06:59:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 06:59:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 06:59:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:00:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:00:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:23] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:00:23] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:00:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:00:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:00:53] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:00:53] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:01:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:01:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:01:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:01:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:01:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:01:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:02:00] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'performed_by_role' in 'field list' - SQL: INSERT INTO `document_workflow_history` (`tenant_id`, `workflow_id`, `file_id`, `from_state`, `to_state`, `transition_type`, `performed_by_user_id`, `performed_by_role`, `comment`, `created_at`) VALUES (:tenant_id, :workflow_id, :file_id, :from_state, :to_state, :transition_type, :performed_by_user_id, :performed_by_role, :comment, :created_at)
[2025-11-14 07:02:00] [ERROR] Errore insert in document_workflow_history: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'performed_by_role' in 'field list'
[2025-11-14 07:02:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:02:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:02:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:02:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:02:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:02:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:03:58] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:03:58] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:23:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:23:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:23:02] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 07:23:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 07:23:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 07:23:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 07:23:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 07:23:03] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 07:23:10] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list' - SQL: SELECT id, file_name, uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-14 07:23:10] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'file_name' in 'field list'
[2025-11-14 07:23:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:23:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:23:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:23:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:23:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:24:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:24:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:24:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:24:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:24:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:24:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:24:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:25:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:25:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:03] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:25:03] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:25:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:25:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:33] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:25:33] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:25:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:25:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:25:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT COUNT(*) as total FROM (SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW())) as subquery
[2025-11-14 07:25:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list' - SQL: SELECT
    fa.id,
    fa.entity_type,
    fa.file_id,
    fa.folder_id,
    fa.assignment_reason,
    fa.expires_at,
    fa.created_at,
    fa.updated_at,

    -- File details
    f.file_name,
    f.file_size,
    f.mime_type,
    f.uploaded_by as file_creator_id,

    -- Folder details
    fo.folder_name,
    fo.created_by as folder_creator_id,

    -- Assigned to user
    u_to.id as assigned_to_id,
    u_to.name as assigned_to_name,
    u_to.email as assigned_to_email,

    -- Assigned by user
    u_by.id as assigned_by_id,
    u_by.name as assigned_by_name,
    u_by.email as assigned_by_email,

    -- Check if expired
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at > NOW() THEN 0
        ELSE 1
    END as is_expired,

    -- Check if expiring soon (within 7 days)
    CASE
        WHEN fa.expires_at IS NULL THEN 0
        WHEN fa.expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) AND fa.expires_at > NOW() THEN 1
        ELSE 0
    END as is_expiring_soon

FROM file_assignments fa
LEFT JOIN files f ON fa.file_id = f.id
LEFT JOIN folders fo ON fa.folder_id = fo.id
LEFT JOIN users u_to ON fa.assigned_to_user_id = u_to.id
LEFT JOIN users u_by ON fa.assigned_by_user_id = u_by.id
WHERE fa.tenant_id = ?
  AND fa.deleted_at IS NULL AND (fa.expires_at IS NULL OR fa.expires_at > NOW()) ORDER BY
    is_expiring_soon DESC,
    is_expired ASC,
    fa.created_at DESC
    LIMIT ? OFFSET ?
[2025-11-14 07:25:51] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'fa.folder_id' in 'field list'
[2025-11-14 07:25:51] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list' - SQL: SELECT
            COUNT(CASE WHEN expires_at IS NULL OR expires_at > NOW() THEN 1 END) as active_count,
            COUNT(CASE WHEN expires_at IS NOT NULL AND expires_at <= NOW() THEN 1 END) as expired_count,
            COUNT(CASE WHEN expires_at IS NOT NULL
                       AND expires_at > NOW()
                       AND expires_at <= DATE_ADD(NOW(), INTERVAL 7 DAY) THEN 1 END) as expiring_soon_count,
            COUNT(DISTINCT file_id) as unique_files,
            COUNT(DISTINCT folder_id) as unique_folders,
            COUNT(DISTINCT assigned_to_user_id) as unique_users
        FROM file_assignments
        WHERE tenant_id = ?
          AND deleted_at IS NULL
[2025-11-14 07:25:51] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'folder_id' in 'field list'
[2025-11-14 07:26:02] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list' - SQL: SELECT id, name AS file_name, created_by AS uploaded_by, folder_id
         FROM files
         WHERE id = ?
           AND tenant_id = ?
           AND deleted_at IS NULL
[2025-11-14 07:26:02] [ERROR] Errore fetchOne: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'created_by' in 'field list'
[2025-11-14 07:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.submitted_at,
            TIMESTAMPDIFF(HOUR, dw.submitted_at, NOW()) as hours_waiting,
            uc.name as creator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_validator_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.submitted_at ASC
[2025-11-14 07:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
            dw.id,
            dw.file_id,
            f.file_name,
            dw.validated_at,
            TIMESTAMPDIFF(HOUR, dw.validated_at, NOW()) as hours_waiting,
            uc.name as creator_name,
            uv.name as validator_name
        FROM document_workflow dw
        INNER JOIN files f ON dw.file_id = f.id
        LEFT JOIN users uc ON dw.created_by_user_id = uc.id
        LEFT JOIN users uv ON dw.validated_by_user_id = uv.id
        WHERE dw.tenant_id = ?
          AND dw.current_state = ?
          AND dw.current_approver_id = ?
          AND dw.deleted_at IS NULL
        ORDER BY dw.validated_at ASC
[2025-11-14 07:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
[2025-11-14 07:26:21] [ERROR] Errore query: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list' - SQL: SELECT
        dw.id,
        dw.file_id,
        f.file_name,
        dw.rejected_at,
        dw.rejection_count,
        dwh.comment as rejection_reason,
        ur.name as rejected_by_name
    FROM document_workflow dw
    INNER JOIN files f ON dw.file_id = f.id
    LEFT JOIN users ur ON dw.rejected_by_user_id = ur.id
    LEFT JOIN document_workflow_history dwh ON (
        dwh.workflow_id = dw.id
        AND dwh.to_state = ?
        AND dwh.id = (
            SELECT MAX(id)
            FROM document_workflow_history
            WHERE workflow_id = dw.id
              AND to_state = ?
        )
    )
    WHERE dw.tenant_id = ?
      AND dw.current_state = ?
      AND dw.created_by_user_id = ?
      AND dw.deleted_at IS NULL
    ORDER BY dw.rejected_at DESC
[2025-11-14 07:26:21] [ERROR] Errore fetchAll: Errore database: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'f.file_name' in 'field list'
