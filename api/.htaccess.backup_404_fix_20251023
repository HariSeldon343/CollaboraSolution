# Enable RewriteEngine
RewriteEngine On
RewriteBase /CollaboraNexio/api/

# CRITICAL FIX - Direct file access bypass (MUST BE FIRST!)
# This rule MUST come before any other rewrite rules
# It allows direct access to ANY existing PHP file
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Handle notifications routes (only if not a real file)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^notifications/unread/?$ notifications.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^notifications/all/?$ notifications.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^notifications/mark-read/?$ notifications.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^notifications/mark-all-read/?$ notifications.php [L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^notifications/?$ notifications.php [L]

# Router fallback - ONLY for non-existent files/directories
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ router.php?route=$1 [QSA,L]