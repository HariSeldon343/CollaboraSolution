<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Events API Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .test-card h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .method-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
        }

        .method-GET { background: #10B981; }
        .method-POST { background: #3B82F6; }
        .method-PUT { background: #F59E0B; }
        .method-DELETE { background: #EF4444; }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 0.9em;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .response-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-code {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
        }

        .status-success { background: #10B981; }
        .status-error { background: #EF4444; }

        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.9em;
        }

        .auth-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .auth-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }

        .auth-status.authenticated {
            background: #10B981;
            color: white;
        }

        .auth-status.not-authenticated {
            background: #EF4444;
            color: white;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .quick-actions button {
            padding: 8px 15px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“… Calendar Events API Test</h1>
            <p>Test all endpoints of the CollaboraNexio Calendar Events REST API</p>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section">
            <h3>Authentication Status
                <span id="authStatus" class="auth-status not-authenticated">Not Authenticated</span>
            </h3>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="authEmail" placeholder="admin@example.com" value="admin@example.com">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="authPassword" placeholder="password" value="password">
            </div>
            <button onclick="authenticate()">Login</button>
            <button onclick="logout()" style="margin-left: 10px; background: #EF4444;">Logout</button>
        </div>

        <!-- Test Cases Grid -->
        <div class="test-grid">
            <!-- Get Events -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-GET">GET</span>
                    Get Events in Range
                </h3>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="datetime-local" id="getStart" value="2024-01-01T00:00">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="datetime-local" id="getEnd" value="2024-12-31T23:59">
                </div>
                <div class="form-group">
                    <label>Calendar ID (optional)</label>
                    <input type="number" id="getCalendarId" placeholder="Leave empty for all">
                </div>
                <div class="form-group">
                    <label>Include Recurring</label>
                    <select id="getIncludeRecurring">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <button onclick="getEvents()">Get Events</button>
            </div>

            <!-- Create Event -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-POST">POST</span>
                    Create Event
                </h3>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="createTitle" value="Team Meeting">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="createDescription">Weekly team standup meeting</textarea>
                </div>
                <div class="form-group">
                    <label>Start</label>
                    <input type="datetime-local" id="createStart" value="2024-01-20T10:00">
                </div>
                <div class="form-group">
                    <label>End</label>
                    <input type="datetime-local" id="createEnd" value="2024-01-20T11:00">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" id="createLocation" value="Conference Room A">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="createCategory">
                        <option value="meeting">Meeting</option>
                        <option value="task">Task</option>
                        <option value="reminder">Reminder</option>
                        <option value="review">Review</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Recurrence (RRULE)</label>
                    <input type="text" id="createRecurrence" placeholder="FREQ=WEEKLY;BYDAY=MO,WE,FR">
                </div>
                <div class="form-group">
                    <label>Participants (comma-separated user IDs)</label>
                    <input type="text" id="createParticipants" placeholder="1,2,3">
                </div>
                <button onclick="createEvent()">Create Event</button>
            </div>

            <!-- Update Event -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-PUT">PUT</span>
                    Update Event
                </h3>
                <div class="form-group">
                    <label>Event ID</label>
                    <input type="number" id="updateId" placeholder="Enter event ID">
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="updateTitle" placeholder="New title">
                </div>
                <div class="form-group">
                    <label>Start</label>
                    <input type="datetime-local" id="updateStart">
                </div>
                <div class="form-group">
                    <label>End</label>
                    <input type="datetime-local" id="updateEnd">
                </div>
                <div class="form-group">
                    <label>Notify Participants</label>
                    <select id="updateNotify">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <button onclick="updateEvent()">Update Event</button>
            </div>

            <!-- Delete Event -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-DELETE">DELETE</span>
                    Delete Event
                </h3>
                <div class="form-group">
                    <label>Event ID</label>
                    <input type="number" id="deleteId" placeholder="Enter event ID">
                </div>
                <div class="form-group">
                    <label>Delete Entire Series (for recurring)</label>
                    <select id="deleteSeries">
                        <option value="false">No - Single Instance</option>
                        <option value="true">Yes - Entire Series</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notify Participants</label>
                    <select id="deleteNotify">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <button onclick="deleteEvent()">Delete Event</button>
            </div>

            <!-- Respond to Invitation -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-POST">POST</span>
                    Respond to Invitation
                </h3>
                <div class="form-group">
                    <label>Event ID</label>
                    <input type="number" id="respondId" placeholder="Enter event ID">
                </div>
                <div class="form-group">
                    <label>Response</label>
                    <select id="respondStatus">
                        <option value="accepted">Accept</option>
                        <option value="declined">Decline</option>
                        <option value="tentative">Maybe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Message (optional)</label>
                    <input type="text" id="respondMessage" placeholder="Looking forward to it!">
                </div>
                <button onclick="respondToInvite()">Send Response</button>
            </div>

            <!-- Check Conflicts -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-GET">GET</span>
                    Check Conflicts
                </h3>
                <div class="form-group">
                    <label>Start</label>
                    <input type="datetime-local" id="conflictStart" value="2024-01-20T10:00">
                </div>
                <div class="form-group">
                    <label>End</label>
                    <input type="datetime-local" id="conflictEnd" value="2024-01-20T11:00">
                </div>
                <div class="form-group">
                    <label>Participants (comma-separated IDs)</label>
                    <input type="text" id="conflictParticipants" placeholder="1,2,3">
                </div>
                <button onclick="checkConflicts()">Check Conflicts</button>
            </div>

            <!-- Get Availability -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-GET">GET</span>
                    Get User Availability
                </h3>
                <div class="form-group">
                    <label>User ID</label>
                    <input type="number" id="availabilityUserId" value="1">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="availabilityDate" value="2024-01-20">
                </div>
                <button onclick="getAvailability()">Get Availability</button>
            </div>

            <!-- Get Suggestions -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-GET">GET</span>
                    Get Meeting Suggestions
                </h3>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="suggestionDuration" value="60">
                </div>
                <div class="form-group">
                    <label>Date Range Start</label>
                    <input type="date" id="suggestionStartDate" value="2024-01-15">
                </div>
                <div class="form-group">
                    <label>Date Range End</label>
                    <input type="date" id="suggestionEndDate" value="2024-01-20">
                </div>
                <div class="form-group">
                    <label>Participants (comma-separated IDs)</label>
                    <input type="text" id="suggestionParticipants" value="1,2">
                </div>
                <button onclick="getSuggestions()">Get Suggestions</button>
            </div>

            <!-- Duplicate Event -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-POST">POST</span>
                    Duplicate Event
                </h3>
                <div class="form-group">
                    <label>Event ID to Duplicate</label>
                    <input type="number" id="duplicateId" placeholder="Enter event ID">
                </div>
                <div class="form-group">
                    <label>New Title</label>
                    <input type="text" id="duplicateTitle" placeholder="Leave empty to auto-generate">
                </div>
                <div class="form-group">
                    <label>New Start</label>
                    <input type="datetime-local" id="duplicateStart">
                </div>
                <div class="form-group">
                    <label>New End</label>
                    <input type="datetime-local" id="duplicateEnd">
                </div>
                <button onclick="duplicateEvent()">Duplicate Event</button>
            </div>

            <!-- Export Events -->
            <div class="test-card">
                <h3>
                    <span class="method-badge method-GET">GET</span>
                    Export Events (iCal)
                </h3>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="exportStart" value="2024-01-01">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="exportEnd" value="2024-12-31">
                </div>
                <button onclick="exportEvents()">Export to iCalendar</button>
            </div>
        </div>

        <!-- Response Display -->
        <div class="response-container">
            <div class="response-header">
                <h3>API Response</h3>
                <span id="statusCode" class="status-code" style="display: none;"></span>
            </div>
            <pre id="response">Response will appear here...</pre>
        </div>

        <!-- Quick Actions -->
        <div class="response-container" style="margin-top: 20px;">
            <h3>Quick Test Actions</h3>
            <div class="quick-actions">
                <button onclick="createSampleEvents()">Create Sample Events</button>
                <button onclick="getUpcomingEvents()">Get Upcoming Events</button>
                <button onclick="getTeamCalendar()">Get Team Calendar</button>
                <button onclick="checkTodayConflicts()">Check Today's Conflicts</button>
                <button onclick="clearAllEvents()" style="background: #EF4444;">Clear All Events</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/CollaboraNexio/api';

        // Helper function to format datetime for API
        function formatDateTimeForAPI(localDateTime) {
            if (!localDateTime) return '';
            const date = new Date(localDateTime);
            return date.toISOString();
        }

        // Helper function to display response
        function displayResponse(data, status) {
            const responseEl = document.getElementById('response');
            const statusEl = document.getElementById('statusCode');

            responseEl.textContent = JSON.stringify(data, null, 2);

            if (status) {
                statusEl.textContent = `Status: ${status}`;
                statusEl.style.display = 'inline-block';
                statusEl.className = status >= 200 && status < 300 ?
                    'status-code status-success' : 'status-code status-error';
            }
        }

        // Authentication
        async function authenticate() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                const response = await fetch(`${API_BASE}/auth.php?action=login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                displayResponse(data, response.status);

                if (data.success) {
                    document.getElementById('authStatus').textContent = 'Authenticated';
                    document.getElementById('authStatus').className = 'auth-status authenticated';
                }
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        async function logout() {
            try {
                const response = await fetch(`${API_BASE}/auth.php?action=logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();
                displayResponse(data, response.status);

                document.getElementById('authStatus').textContent = 'Not Authenticated';
                document.getElementById('authStatus').className = 'auth-status not-authenticated';
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Get Events
        async function getEvents() {
            const start = formatDateTimeForAPI(document.getElementById('getStart').value);
            const end = formatDateTimeForAPI(document.getElementById('getEnd').value);
            const calendarId = document.getElementById('getCalendarId').value;
            const includeRecurring = document.getElementById('getIncludeRecurring').value;

            let url = `${API_BASE}/events.php?start=${start}&end=${end}&include_recurring=${includeRecurring}`;
            if (calendarId) url += `&calendar_id=${calendarId}`;

            try {
                const response = await fetch(url, {
                    credentials: 'include'
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Create Event
        async function createEvent() {
            const participants = document.getElementById('createParticipants').value
                .split(',')
                .filter(id => id.trim())
                .map(id => ({ user_id: parseInt(id.trim()) }));

            const body = {
                title: document.getElementById('createTitle').value,
                description: document.getElementById('createDescription').value,
                start: formatDateTimeForAPI(document.getElementById('createStart').value),
                end: formatDateTimeForAPI(document.getElementById('createEnd').value),
                location: document.getElementById('createLocation').value,
                category: document.getElementById('createCategory').value,
                recurrence: document.getElementById('createRecurrence').value,
                participants: participants,
                reminders: [
                    { type: 'email', minutes_before: 1440 },
                    { type: 'notification', minutes_before: 15 }
                ]
            };

            try {
                const response = await fetch(`${API_BASE}/events.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Update Event
        async function updateEvent() {
            const id = document.getElementById('updateId').value;
            const notify = document.getElementById('updateNotify').value;

            if (!id) {
                alert('Please enter an event ID');
                return;
            }

            const body = {};
            const title = document.getElementById('updateTitle').value;
            const start = document.getElementById('updateStart').value;
            const end = document.getElementById('updateEnd').value;

            if (title) body.title = title;
            if (start) body.start = formatDateTimeForAPI(start);
            if (end) body.end = formatDateTimeForAPI(end);

            try {
                const response = await fetch(`${API_BASE}/events.php?id=${id}&notify_participants=${notify}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Delete Event
        async function deleteEvent() {
            const id = document.getElementById('deleteId').value;
            const deleteSeries = document.getElementById('deleteSeries').value;
            const notify = document.getElementById('deleteNotify').value;

            if (!id) {
                alert('Please enter an event ID');
                return;
            }

            if (!confirm('Are you sure you want to delete this event?')) {
                return;
            }

            try {
                const response = await fetch(
                    `${API_BASE}/events.php?id=${id}&delete_series=${deleteSeries}&notify_participants=${notify}`,
                    {
                        method: 'DELETE',
                        credentials: 'include'
                    }
                );

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Respond to Invitation
        async function respondToInvite() {
            const id = document.getElementById('respondId').value;

            if (!id) {
                alert('Please enter an event ID');
                return;
            }

            const body = {
                response: document.getElementById('respondStatus').value,
                message: document.getElementById('respondMessage').value
            };

            try {
                const response = await fetch(`${API_BASE}/events.php?action=respond&id=${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Check Conflicts
        async function checkConflicts() {
            const start = formatDateTimeForAPI(document.getElementById('conflictStart').value);
            const end = formatDateTimeForAPI(document.getElementById('conflictEnd').value);
            const participants = document.getElementById('conflictParticipants').value
                .split(',')
                .filter(id => id.trim())
                .map(id => id.trim());

            let url = `${API_BASE}/events.php?action=conflicts&start=${start}&end=${end}`;
            participants.forEach(id => {
                url += `&participants[]=${id}`;
            });

            try {
                const response = await fetch(url, {
                    credentials: 'include'
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Get Availability
        async function getAvailability() {
            const userId = document.getElementById('availabilityUserId').value;
            const date = document.getElementById('availabilityDate').value;

            try {
                const response = await fetch(
                    `${API_BASE}/events.php?action=availability&user_id=${userId}&date=${date}`,
                    {
                        credentials: 'include'
                    }
                );

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Get Suggestions
        async function getSuggestions() {
            const duration = document.getElementById('suggestionDuration').value;
            const startDate = document.getElementById('suggestionStartDate').value;
            const endDate = document.getElementById('suggestionEndDate').value;
            const participants = document.getElementById('suggestionParticipants').value
                .split(',')
                .filter(id => id.trim())
                .map(id => id.trim());

            let url = `${API_BASE}/events.php?action=suggestions&duration=${duration}`;
            url += `&date_range_start=${startDate}&date_range_end=${endDate}`;
            participants.forEach(id => {
                url += `&participants[]=${id}`;
            });

            try {
                const response = await fetch(url, {
                    credentials: 'include'
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Duplicate Event
        async function duplicateEvent() {
            const id = document.getElementById('duplicateId').value;

            if (!id) {
                alert('Please enter an event ID');
                return;
            }

            const body = {};
            const title = document.getElementById('duplicateTitle').value;
            const start = document.getElementById('duplicateStart').value;
            const end = document.getElementById('duplicateEnd').value;

            if (title) body.title = title;
            if (start) body.start = formatDateTimeForAPI(start);
            if (end) body.end = formatDateTimeForAPI(end);
            body.copy_participants = true;
            body.copy_reminders = true;

            try {
                const response = await fetch(`${API_BASE}/events.php?action=duplicate&id=${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Export Events
        async function exportEvents() {
            const start = document.getElementById('exportStart').value;
            const end = document.getElementById('exportEnd').value;

            const url = `${API_BASE}/events.php?action=export&format=ics&start=${start}&end=${end}`;

            try {
                window.open(url, '_blank');
                displayResponse({ message: 'Download started...' }, 200);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Quick Actions
        async function createSampleEvents() {
            const events = [
                {
                    title: 'Daily Standup',
                    description: 'Team sync meeting',
                    start: new Date(Date.now() + 24*60*60*1000).toISOString(),
                    end: new Date(Date.now() + 24*60*60*1000 + 30*60*1000).toISOString(),
                    category: 'meeting',
                    recurrence: 'FREQ=DAILY;BYDAY=MO,TU,WE,TH,FR'
                },
                {
                    title: 'Project Review',
                    description: 'Monthly project status review',
                    start: new Date(Date.now() + 7*24*60*60*1000).toISOString(),
                    end: new Date(Date.now() + 7*24*60*60*1000 + 120*60*1000).toISOString(),
                    category: 'review',
                    recurrence: 'FREQ=MONTHLY;BYMONTHDAY=15'
                },
                {
                    title: 'Team Lunch',
                    description: 'Team building lunch',
                    start: new Date(Date.now() + 3*24*60*60*1000).toISOString(),
                    end: new Date(Date.now() + 3*24*60*60*1000 + 90*60*1000).toISOString(),
                    location: 'Restaurant Downtown',
                    category: 'other'
                }
            ];

            for (const event of events) {
                try {
                    const response = await fetch(`${API_BASE}/events.php`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(event)
                    });
                    console.log(`Created: ${event.title}`, await response.json());
                } catch (error) {
                    console.error(`Failed to create: ${event.title}`, error);
                }
            }

            displayResponse({ message: 'Sample events creation completed. Check console for details.' }, 200);
        }

        async function getUpcomingEvents() {
            const start = new Date().toISOString();
            const end = new Date(Date.now() + 7*24*60*60*1000).toISOString();

            try {
                const response = await fetch(
                    `${API_BASE}/events.php?start=${start}&end=${end}`,
                    {
                        credentials: 'include'
                    }
                );

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        async function checkTodayConflicts() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            try {
                const response = await fetch(
                    `${API_BASE}/events.php?action=conflicts&start=${today.toISOString()}&end=${tomorrow.toISOString()}`,
                    {
                        credentials: 'include'
                    }
                );

                const data = await response.json();
                displayResponse(data, response.status);
            } catch (error) {
                displayResponse({ error: error.message }, 500);
            }
        }

        // Initialize - check auth status on load
        window.onload = async function() {
            try {
                const response = await fetch(`${API_BASE}/auth.php?action=check`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.data.authenticated) {
                    document.getElementById('authStatus').textContent = 'Authenticated';
                    document.getElementById('authStatus').className = 'auth-status authenticated';
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        };
    </script>
</body>
</html>