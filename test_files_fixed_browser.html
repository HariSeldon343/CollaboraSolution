<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Test Files API Fixed</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f4f4f4; padding: 10px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Test Files API Fixed (files_tenant_fixed.php)</h1>

    <div>
        <button onclick="testList(4)">Test List Folder ID 4</button>
        <button onclick="testList(3)">Test List Folder ID 3</button>
        <button onclick="testList('')">Test List Root</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        async function testList(folderId) {
            const resultsDiv = document.getElementById('results');
            const url = `/CollaboraNexio/api/files_tenant_fixed.php?action=list&folder_id=${folderId}&search=`;

            resultsDiv.innerHTML += `<h3>Testing: action=list&folder_id=${folderId}&search=</h3>`;

            try {
                const response = await fetch(url, {
                    credentials: 'include'
                });

                const statusClass = response.ok ? 'success' : 'error';
                resultsDiv.innerHTML += `<p class="${statusClass}">HTTP Status: ${response.status}</p>`;

                const data = await response.json();
                resultsDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;

                if (data.success) {
                    resultsDiv.innerHTML += `<p class="success">âœ“ Items found: ${data.data.items.length}</p>`;
                    resultsDiv.innerHTML += `<p>User Role: ${data.data.user_role}</p>`;
                    resultsDiv.innerHTML += `<p>Can Create Root: ${data.data.can_create_root}</p>`;
                }

            } catch (error) {
                resultsDiv.innerHTML += `<p class="error">Error: ${error.message}</p>`;
            }

            resultsDiv.innerHTML += '<hr>';
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
